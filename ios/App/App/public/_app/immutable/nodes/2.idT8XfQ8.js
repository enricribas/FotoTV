import"../chunks/NZTpNUN0.js";import{i as ke}from"../chunks/B3MA-1DU.js";import{l as Xe,w as k,e as x,s as K,o as Ze}from"../chunks/BO6TyhyF.js";import{k as xe,aF as er,y as ie,I as rr,Q as tr,p as $e,aG as ar,aH as sr,f as w,h as Pe,d,c as n,r as i,t as P,a as p,b as Ee,g as Fe,m as or,n as fe,aI as Ve,L as nr,s as ir,i as lr}from"../chunks/BEP-pFgy.js";import{i as $}from"../chunks/Bk1onwOX.js";import{r as Le,s as Me,l as dr,g as Te,u as cr,c as ur,a as F,e as vr,f as gr,h as fr,i as le,o as mr,j as pr,b as hr}from"../chunks/DzXJSvQv.js";import{p as Re,b as br,s as U,a as Ie,c as de}from"../chunks/BcS2JFNH.js";import{g as wr}from"../chunks/DJw6Zyxy.js";function yr(r,e,t){var u=r==null?"":""+r;return u===""?null:u}function ge(r,e,t,u,a,l){var s=r.__className;if(xe||s!==t||s===void 0){var h=yr(t);(!xe||h!==r.getAttribute("class"))&&(h==null?r.removeAttribute("class"):r.className=h),r.__className=t}return l}function ce(r,e,t=e){var u=er(),a=new WeakSet;Xe(r,"input",l=>{var s=l?r.defaultValue:r.value;if(s=ye(r)?_e(s):s,t(s),ie!==null&&a.add(ie),u&&s!==(s=e())){var h=r.selectionStart,A=r.selectionEnd;r.value=s??"",A!==null&&(r.selectionStart=h,r.selectionEnd=Math.min(A,r.value.length))}}),(xe&&r.defaultValue!==r.value||rr(e)==null&&r.value)&&(t(ye(r)?_e(r.value):r.value),ie!==null&&a.add(ie)),tr(()=>{var l=e();r===document.activeElement&&a.has(ie)||ye(r)&&l===_e(r.value)||r.type==="date"&&!l&&!r.value||l!==r.value&&(r.value=l??"")})}function ye(r){var e=r.type;return e==="number"||e==="range"}function _e(r){return r===""?null:+r}function _r(r){return function(...e){var t=e[0];return t.preventDefault(),r?.apply(this,e)}}class Ne{static async loadUserImages(e){if(!e)return[];try{const t=Le(Me,`images/${e.uid}`),a=(await dr(t)).items.sort((s,h)=>s.name.localeCompare(h.name));return await Promise.all(a.map(async s=>await Te(s)))}catch(t){return console.error("Error loading images:",t),[]}}static async loadUserImagesWithRetry(e,t=0,u=3){if(!e)return[];let a=0,l=[];for(;a<u&&(a>0&&await new Promise(s=>setTimeout(s,500*a)),l=await this.loadUserImages(e),!(l.length>t));)a++;return l}}var xr=w('<span class="loading loading-spinner loading-sm"></span> Uploading...',1),Pr=Ve('<svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg> Upload Photo',1),kr=w('<input type="file" accept="image/*" class="hidden"/> <div class="flex flex-col items-center space-y-4"><button class="btn w-full border-orange-500 bg-orange-500 text-white hover:bg-orange-600"><!></button> <button class="btn w-full border-red-500 bg-red-500 text-white hover:bg-red-600"><svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Slideshow</button></div>',1);function $r(r,e){$e(e,!1);const[t,u]=Ie(),a=()=>U(h,"$uploading",t);let l=Re(e,"user",8),s=Re(e,"uploadedImages",12);const h=k(!1),A=k(s());A.subscribe(c=>{s(c)});let g=or();function L(){Fe(g)?.click()}async function te(c){const b=c.target,I=b.files;if(!(!I||I.length===0||!l())){h.set(!0);try{const V=I[0];if(!V.type.startsWith("image/")){alert("Please select an image file");return}const X=Date.now(),H=`${l().uid}/${X}_${V.name}`,Z=Le(Me,`images/${H}`),G=await cr(Z,V),C=await Te(G.ref);A.set([...s(),C]);const f=await Ne.loadUserImagesWithRetry(l(),s().length-1);A.set(f)}catch(V){console.error("Upload failed:",V),alert("Upload failed. Please try again.")}finally{h.set(!1),b.value=""}}}ar(()=>nr(s()),()=>{A.set(s())}),sr(),ke();var R=kr(),N=Pe(R);br(N,c=>ir(g,c),()=>Fe(g));var q=d(N,2),E=n(q),W=n(E);{var B=c=>{var b=xr();fe(),p(c,b)},z=c=>{var b=Pr();fe(),p(c,b)};$(W,c=>{a()?c(B):c(z,!1)})}i(E);var O=d(E,2);i(q),P(()=>E.disabled=a()),x("change",N,te),x("click",E,L),x("click",O,()=>wr("/slideshow")),p(r,R),Ee(),u()}class re{static async register(e,t,u){try{const l=(await ur(F,e,t)).user;return u&&await vr(l,{displayName:u}),console.log("User registered successfully:",l.uid),l}catch(a){console.error("Registration error:",a);const l=a;throw new Error(this.getErrorMessage(l.code))}}static async signIn(e,t){try{const u=await gr(F,e,t);return console.log("User signed in successfully:",u.user.uid),u.user}catch(u){console.error("Sign in error:",u);const a=u;throw new Error(this.getErrorMessage(a.code))}}static async resetPassword(e){try{await fr(F,e),console.log("Password reset email sent to:",e)}catch(t){console.error("Password reset error:",t);const u=t;throw new Error(this.getErrorMessage(u.code))}}static async signOut(){try{await F.signOut(),console.log("User signed out successfully")}catch(e){throw console.error("Sign out error:",e),e}}static getCurrentUser(){return F.currentUser}static async getCurrentUserAsync(){return new Promise(e=>{const t=F.onAuthStateChanged(u=>{t(),e(u)})})}static isSignedIn(){return!!F.currentUser}static async getAuthToken(){try{const e=F.currentUser;return e?await e.getIdToken():null}catch(e){return console.error("Error getting auth token:",e),null}}static async refreshAuthToken(){try{const e=F.currentUser;return e?await e.getIdToken(!0):null}catch(e){return console.error("Error refreshing auth token:",e),null}}static getErrorMessage(e){switch(e){case"auth/email-already-in-use":return"This email address is already registered. Please use a different email or try signing in.";case"auth/invalid-email":return"Please enter a valid email address.";case"auth/operation-not-allowed":return"Email/password accounts are not enabled. Please contact support.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/user-disabled":return"This account has been disabled. Please contact support.";case"auth/user-not-found":return"No account found with this email address. Please check your email or create a new account.";case"auth/wrong-password":return"Incorrect password. Please try again or reset your password.";case"auth/invalid-credential":return"Invalid email or password. Please check your credentials and try again.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later or reset your password.";case"auth/network-request-failed":return"Network error. Please check your internet connection and try again.";default:return"An error occurred during authentication. Please try again."}}static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static isValidPassword(e){return e.length<6?{valid:!1,message:"Password must be at least 6 characters long"}:{valid:!0}}}var Er=w('<span class="loading loading-spinner loading-sm mr-2"></span> Sending...',1),Ir=Ve('<svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> Send Reset Email',1),Ur=w(`<div class="space-y-4"><div class="text-center"><h2 class="text-2xl font-bold text-gray-800">Reset Password</h2> <p class="mt-2 text-sm text-gray-600">Enter your email address and we'll send you a link to reset your password</p></div> <div class="space-y-4"><div><label for="reset-email" class="mb-1 block text-sm font-medium text-gray-700">Email Address</label> <input id="reset-email" type="email" placeholder="Enter your email" class="input input-bordered w-full"/></div> <button class="btn w-full border-0 bg-blue-500 text-white hover:bg-blue-600"><!></button> <button class="btn btn-ghost w-full text-gray-600">Back to Sign In</button></div></div>`),Ar=w(`<div class="text-center"><p class="text-sm text-gray-600">Don't have an account? <button class="ml-1 font-semibold text-orange-600 underline hover:text-orange-700">Create Account</button></p></div>`),Cr=w('<div><label for="display-name" class="mb-1 block text-sm font-medium text-gray-700">Display Name</label> <input id="display-name" type="text" placeholder="Name to display" class="input input-bordered w-full" required/></div>'),Sr=w('<p class="mt-1 text-xs text-gray-500">Password must be at least 6 characters long</p>'),Fr=w('<div><label for="confirm-password" class="mb-1 block text-sm font-medium text-gray-700">Confirm Password</label> <input id="confirm-password" type="password" placeholder="Confirm your password" class="input input-bordered w-full" required/></div>'),Rr=w('<span class="loading loading-spinner loading-sm mr-2"></span> ',1),Vr=w('<button class="text-sm text-blue-600 underline hover:text-blue-700">Forgot your password?</button>'),Lr=w('<div class="flex items-center"><div class="flex-1 border-t border-gray-300"></div> <span class="px-3 text-sm text-gray-500">or</span> <div class="flex-1 border-t border-gray-300"></div></div> <p class="text-sm text-gray-600">Already have an account? <button class="ml-1 text-blue-600 underline hover:text-blue-700">Sign In</button></p>',1),Mr=w('<div class="space-y-4"><div class="text-center"><h2 class="text-2xl font-bold text-gray-800"> </h2> <p class="mt-2 text-sm text-gray-600"> </p></div> <!> <form class="space-y-4"><!> <div><label for="email" class="mb-1 block text-sm font-medium text-gray-700">Email Address</label> <input id="email" type="email" placeholder="Enter your email" class="input input-bordered w-full" required/></div> <div><label for="password" class="mb-1 block text-sm font-medium text-gray-700">Password</label> <input id="password" type="password" placeholder="Enter your password" class="input input-bordered w-full" required/> <!></div> <!> <button type="submit" class="btn w-full border-0 bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600"><!></button></form> <div class="space-y-2 text-center"><!> <!></div></div>'),Tr=w("<div> </div>"),Nr=w('<div class="space-y-6"><!> <!></div>');function qr(r,e){$e(e,!1);const[t,u]=Ie(),a=()=>U(B,"$email",t),l=()=>U(z,"$password",t),s=()=>U(q,"$isRegistering",t),h=()=>U(c,"$displayName",t),A=()=>U(O,"$confirmPassword",t),g=()=>U(E,"$isLoading",t),L=()=>U(b,"$resetEmail",t),te=()=>U(W,"$showForgotPassword",t),R=()=>U(I,"$message",t),N=()=>U(V,"$messageType",t),q=k(!0),E=k(!1),W=k(!1),B=k(""),z=k(""),O=k(""),c=k(""),b=k(""),I=k(""),V=k("error");function X(){q.update(m=>!m),G()}function H(){W.set(!0),G()}function Z(){W.set(!1),G()}function G(){B.set(""),z.set(""),O.set(""),c.set(""),b.set(""),I.set("")}function C(){I.set("")}function f(m,_="error"){I.set(m),V.set(_)}function M(){if(!a()||!l())return f("Please fill in all required fields"),!1;if(!re.isValidEmail(a()))return f("Please enter a valid email address"),!1;const m=re.isValidPassword(l());if(!m.valid)return f(m.message||"Invalid password"),!1;if(s()){if(!h()?.trim())return f("Please enter your name"),!1;if(l()!==A())return f("Passwords do not match"),!1}return!0}async function Q(){if(!g()&&(C(),!!M())){E.set(!0);try{s()?(await re.register(a(),l(),h()),f("Account created successfully! You are now signed in.","success")):(await re.signIn(a(),l()),f("Signed in successfully!","success"))}catch(m){f(m.message||"An error occurred. Please try again.")}finally{E.set(!1)}}}async function ae(){if(!g()){if(C(),!L()){f("Please enter your email address");return}if(!re.isValidEmail(L())){f("Please enter a valid email address");return}E.set(!0);try{await re.resetPassword(L()),f("Password reset email sent! Check your inbox.","success"),b.set("")}catch(m){f(m.message||"Failed to send password reset email")}finally{E.set(!1)}}}ke();var se=Nr(),Ue=n(se);{var qe=m=>{var _=Ur(),j=d(n(_),2),Y=n(j),ee=d(n(Y),2);le(ee),i(Y);var D=d(Y,2),me=n(D);{var ue=S=>{var oe=Er();fe(),p(S,oe)},pe=S=>{var oe=Ir();fe(),p(S,oe)};$(me,S=>{g()?S(ue):S(pe,!1)})}i(D);var J=d(D,2);i(j),i(_),P(()=>{ee.disabled=g(),D.disabled=g(),J.disabled=g()}),ce(ee,L,S=>de(b,S)),x("input",ee,C),x("click",D,ae),x("click",J,Z),p(m,_)},We=m=>{var _=Mr(),j=n(_),Y=n(j),ee=n(Y,!0);i(Y);var D=d(Y,2),me=n(D,!0);i(D),i(j);var ue=d(j,2);{var pe=o=>{var v=Ar(),y=n(v),T=d(n(y));i(y),i(v),P(()=>T.disabled=g()),x("click",T,X),p(o,v)};$(ue,o=>{s()||o(pe)})}var J=d(ue,2),S=n(J);{var oe=o=>{var v=Cr(),y=d(n(v),2);le(y),i(v),P(()=>y.disabled=g()),ce(y,h,T=>de(c,T)),x("input",y,C),p(o,v)};$(S,o=>{s()&&o(oe)})}var he=d(S,2),ve=d(n(he),2);le(ve),i(he);var be=d(he,2),ne=d(n(be),2);le(ne);var Be=d(ne,2);{var ze=o=>{var v=Sr();p(o,v)};$(Be,o=>{s()&&o(ze)})}i(be);var Ae=d(be,2);{var Oe=o=>{var v=Fr(),y=d(n(v),2);le(y),i(v),P(()=>y.disabled=g()),ce(y,A,T=>de(O,T)),x("input",y,C),p(o,v)};$(Ae,o=>{s()&&o(Oe)})}var we=d(Ae,2),He=n(we);{var Ge=o=>{var v=Rr(),y=d(Pe(v));P(()=>K(y,` ${s()?"Creating Account...":"Signing In..."}`)),p(o,v)},Qe=o=>{var v=lr();P(()=>K(v,s()?"Create Account":"Sign In")),p(o,v)};$(He,o=>{g()?o(Ge):o(Qe,!1)})}i(we),i(J);var Ce=d(J,2),Se=n(Ce);{var Ye=o=>{var v=Vr();P(()=>v.disabled=g()),x("click",v,H),p(o,v)};$(Se,o=>{s()||o(Ye)})}var Je=d(Se,2);{var Ke=o=>{var v=Lr(),y=d(Pe(v),2),T=d(n(y));i(y),P(()=>T.disabled=g()),x("click",T,X),p(o,v)};$(Je,o=>{s()&&o(Ke)})}i(Ce),i(_),P(()=>{K(ee,s()?"Create Account":"Sign In"),K(me,s()?"Create your FotoTV account to get started":"Welcome back! Please sign in to continue"),ve.disabled=g(),ne.disabled=g(),we.disabled=g()}),ce(ve,a,o=>de(B,o)),x("input",ve,C),ce(ne,l,o=>de(z,o)),x("input",ne,C),x("submit",J,_r(Q)),p(m,_)};$(Ue,m=>{te()?m(qe):m(We,!1)})}var je=d(Ue,2);{var De=m=>{var _=Tr(),j=n(_,!0);i(_),P(()=>{ge(_,1,`rounded-lg p-3 text-center text-sm ${N()==="error"?"border border-red-200 bg-red-50 text-red-600":"border border-green-200 bg-green-50 text-green-600"}`),K(j,R())}),p(m,_)};$(je,m=>{R()&&m(De)})}i(se),p(r,se),Ee(),u()}var Wr=w('<div class="avatar"><div class="h-8 w-8 rounded-full ring ring-orange-500 ring-offset-1 ring-offset-white"><img alt="User avatar"/></div></div>'),jr=w('<div class="flex h-8 w-8 items-center justify-center rounded-full bg-orange-500 ring ring-orange-500 ring-offset-1 ring-offset-white"><span class="text-sm font-semibold text-white"> </span></div>'),Dr=w('<div class="absolute top-4 right-4 z-10 flex items-center space-x-2"><!> <div class="text-sm text-gray-800"><span class="font-semibold"> </span></div> <button class="btn btn-sm ml-2 border-white bg-white text-gray-700 hover:bg-gray-100">Logout</button></div>'),Br=w('<div class="relative flex min-h-screen flex-col items-center justify-center bg-gradient-to-br from-orange-100 to-red-100 p-4"><!> <div><div class="flex items-center space-x-3"><img src="/FotoTV-logo2.png" alt="FotoTV Logo"/> <h1>FotoTV</h1></div></div> <div class="w-full max-w-md"><!></div></div>');function Xr(r,e){$e(e,!1);const[t,u]=Ie(),a=()=>U(s,"$user",t),l=()=>U(h,"$uploadedImages",t),s=k(null),h=k([]);Ze(()=>mr(F,async b=>{if(s.set(b),b){const I=await Ne.loadUserImages(b);h.set(I)}else h.set([])}));function A(){pr(F).catch(console.error)}ke();var g=Br(),L=n(g);{var te=c=>{var b=Dr(),I=n(b);{var V=f=>{var M=Wr(),Q=n(M),ae=n(Q);i(Q),i(M),P(()=>hr(ae,"src",a().photoURL)),p(f,M)},X=f=>{var M=jr(),Q=n(M),ae=n(Q,!0);i(Q),i(M),P(se=>K(ae,se),[()=>a().displayName?a().displayName.charAt(0).toUpperCase():a().email?.charAt(0).toUpperCase()||"U"]),p(f,M)};$(I,f=>{a().photoURL?f(V):f(X,!1)})}var H=d(I,2),Z=n(H),G=n(Z,!0);i(Z),i(H);var C=d(H,2);i(b),P(()=>K(G,a().displayName||a().email)),x("click",C,A),p(c,b)};$(L,c=>{a()&&c(te)})}var R=d(L,2),N=n(R),q=n(N),E=d(q,2);i(N),i(R);var W=d(R,2),B=n(W);{var z=c=>{$r(c,{get user(){return a()},get uploadedImages(){return l()}})},O=c=>{qr(c,{})};$(B,c=>{a()?c(z):c(O,!1)})}i(W),i(g),P(()=>{ge(R,1,`${a()?"absolute top-4 left-4":"absolute top-8 left-1/2 -translate-x-1/2 transform"} z-10`),ge(q,1,`${a()?"h-8":"h-16"} w-auto`),ge(E,1,`${a()?"text-lg":"text-3xl"} font-bold text-gray-800`)}),p(r,g),Ee(),u()}export{Xr as component};
