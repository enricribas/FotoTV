const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CUdqvLQw.js","../chunks/BKL8hVvl.js","../chunks/DCj4iFuT.js","../chunks/DPN3YqL6.js"])))=>i.map(i=>d[i]);
import"../chunks/NZTpNUN0.js";import{i as pe}from"../chunks/DK3Qv-gY.js";import{x as Ue,q as K,ao as ct,z as Ve,u as dt,l as gt,h as ue,a6 as vt,v as ft,H as pt,w as We,y as $e,G as ve,ap as mt,aq as ht,A as Ce,C as bt,B as ce,ar as He,as as yt,m as Be,at as Te,au as wt,D as Ke,F as _t,av as xt,aw as ke,ax as Ye,ay as It,az as At,aA as Ut,aB as $t,aC as kt,aD as St,a9 as Et,aE as Pt,aF as Nt,O as Ct,Z as Tt,g as qe,p as me,aG as Dt,aH as Lt,f as M,j as Je,s as b,d as f,r as v,t as Y,e as z,b as T,c as he,n as le,aI as Le,R as Gt,o as _e,K as J,a as Rt,i as Ft}from"../chunks/BKL8hVvl.js";import{i as j}from"../chunks/DUN4N4P8.js";import{r as Xe,s as Mt}from"../chunks/CUdqvLQw.js";import{p as je,b as zt,s as O,a as be,c as Ze}from"../chunks/BKbtAyOQ.js";import{r as Qe,s as et,l as Ot,g as tt,a1 as Wt,$ as S,a,a0 as Se,S as jt,_ as Vt,o as Ht,a2 as Bt}from"../chunks/DCj4iFuT.js";import{w as R}from"../chunks/DSNl90D1.js";import{g as Kt}from"../chunks/t-ZXMKOV.js";import{F as C,A as ae}from"../chunks/u5NA2Mim.js";import{_ as Ge}from"../chunks/D9Z9MdNV.js";function Yt(r,e){return e}function qt(r,e,t){for(var n=r.items,s=[],o=e.length,u=0;u<o;u++)$t(e[u].e,s,!0);var p=o>0&&s.length===0&&t!==null;if(p){var y=t.parentNode;kt(y),y.append(t),n.clear(),ee(r,e[0].prev,e[o-1].next)}St(s,()=>{for(var w=0;w<o;w++){var A=e[w];p||(n.delete(A.k),ee(r,A.prev,A.next)),Ye(A.e,!p)}})}function Jt(r,e,t,n,s,o=null){var u=r,p={flags:e,items:new Map,first:null};{var y=r;u=K?Ue(ct(y)):y.appendChild(Ve())}K&&dt();var w=null,A=!1,D=new Map,i=vt(()=>{var x=t();return yt(x)?x:x==null?[]:He(x)}),_,d;function m(){Xt(d,_,p,D,u,s,e,n,t),o!==null&&(_.length===0?w?Ke(w):w=Ce(()=>o(u)):w!==null&&_t(w,()=>{w=null}))}gt(()=>{d??=Et,_=ue(i);var x=_.length;if(A&&x===0)return;A=x===0;let L=!1;if(K){var N=ft(u)===pt;N!==(x===0)&&(u=We(),Ue(u),$e(!1),L=!0)}if(K){for(var I=null,c,h=0;h<x;h++){if(ve.nodeType===mt&&ve.data===ht){u=ve,L=!0,$e(!1);break}var $=_[h],g=n($,h);c=De(ve,p,I,null,$,g,h,s,e,t),p.items.set(g,c),I=c}x>0&&Ue(We())}if(K)x===0&&o&&(w=Ce(()=>o(u)));else if(bt()){var U=new Set,k=ce;for(h=0;h<x;h+=1){$=_[h],g=n($,h);var G=p.items.get(g)??D.get(g);G?rt(G,$,h):(c=De(null,p,null,null,$,g,h,s,e,t,!0),D.set(g,c)),U.add(g)}for(const[F,E]of p.items)U.has(F)||k.skipped_effects.add(E.e);k.add_callback(m)}else m();L&&$e(!0),ue(i)}),K&&(u=ve)}function Xt(r,e,t,n,s,o,u,p,y){var w=e.length,A=t.items,D=t.first,i=D,_,d=null,m=[],x=[],L,N,I,c;for(c=0;c<w;c+=1){if(L=e[c],N=p(L,c),I=A.get(N),I===void 0){var h=n.get(N);if(h!==void 0){n.delete(N),A.set(N,h);var $=d?d.next:i;ee(t,d,h),ee(t,h,$),Ee(h,$,s),d=h}else{var g=i?i.e.nodes_start:s;d=De(g,t,d,d===null?t.first:d.next,L,N,c,o,u,y)}A.set(N,d),m=[],x=[],i=d.next;continue}if(rt(I,L,c),(I.e.f&ke)!==0&&Ke(I.e),I!==i){if(_!==void 0&&_.has(I)){if(m.length<x.length){var U=x[0],k;d=U.prev;var G=m[0],F=m[m.length-1];for(k=0;k<m.length;k+=1)Ee(m[k],U,s);for(k=0;k<x.length;k+=1)_.delete(x[k]);ee(t,G.prev,F.next),ee(t,d,G),ee(t,F,U),i=U,d=F,c-=1,m=[],x=[]}else _.delete(I),Ee(I,i,s),ee(t,I.prev,I.next),ee(t,I,d===null?t.first:d.next),ee(t,d,I),d=I;continue}for(m=[],x=[];i!==null&&i.k!==N;)(i.e.f&ke)===0&&(_??=new Set).add(i),x.push(i),i=i.next;if(i===null)continue;I=i}m.push(I),d=I,i=I.next}if(i!==null||_!==void 0){for(var E=_===void 0?[]:He(_);i!==null;)(i.e.f&ke)===0&&E.push(i),i=i.next;var V=E.length;if(V>0){var X=w===0?s:null;qt(t,E,X)}}r.first=t.first&&t.first.e,r.last=d&&d.e;for(var q of n.values())Ye(q.e);n.clear()}function rt(r,e,t,n){wt(r.v,e),r.i=t}function De(r,e,t,n,s,o,u,p,y,w,A){var D=(y&It)!==0,i=(y&At)===0,_=D?i?Be(s,!1,!1):Te(s):s,d=(y&xt)===0?u:Te(u),m={i:d,v:_,k:o,a:null,e:null,prev:t,next:n};try{if(r===null){var x=document.createDocumentFragment();x.append(r=Ve())}return m.e=Ce(()=>p(r,_,d,w),K),m.e.prev=t&&t.e,m.e.next=n&&n.e,t===null?A||(e.first=m):(t.next=m,t.e.next=m.e),n!==null&&(n.prev=m,n.e.prev=m.e),m}finally{}}function Ee(r,e,t){for(var n=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,o=r.e.nodes_start;o!==null&&o!==n;){var u=Ut(o);s.before(o),o=u}}function ee(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Zt(r,e,t){var n=r==null?"":""+r;return n===""?null:n}function Qt(r,e){return r==null?null:String(r)}function we(r,e,t,n,s,o){var u=r.__className;if(K||u!==t||u===void 0){var p=Zt(t);(!K||p!==r.getAttribute("class"))&&(p==null?r.removeAttribute("class"):r.className=p),r.__className=t}return o}function er(r,e,t,n){var s=r.__style;if(K||s!==e){var o=Qt(e);(!K||o!==r.getAttribute("style"))&&(o==null?r.removeAttribute("style"):r.style.cssText=o),r.__style=e}return n}function st(r,e,t=e){var n=Pt(),s=new WeakSet;Nt(r,"input",o=>{var u=o?r.defaultValue:r.value;if(u=Pe(r)?Ne(u):u,t(u),ce!==null&&s.add(ce),n&&u!==(u=e())){var p=r.selectionStart,y=r.selectionEnd;r.value=u??"",y!==null&&(r.selectionStart=p,r.selectionEnd=Math.min(y,r.value.length))}}),(K&&r.defaultValue!==r.value||Ct(e)==null&&r.value)&&(t(Pe(r)?Ne(r.value):r.value),ce!==null&&s.add(ce)),Tt(()=>{var o=e();r===document.activeElement&&s.has(ce)||Pe(r)&&o===Ne(r.value)||r.type==="date"&&!o&&!r.value||o!==r.value&&(r.value=o??"")})}function Pe(r){var e=r.type;return e==="number"||e==="range"}function Ne(r){return r===""?null:+r}function tr(r){var e=Te(0);return function(){return arguments.length===1?(qe(e,ue(e)+1),arguments[0]):(ue(e),r())}}class at{static async loadUserImages(e){if(!e)return[];try{const t=Qe(et,`images/${e.uid}`),s=(await Ot(t)).items.sort((u,p)=>u.name.localeCompare(p.name));return await Promise.all(s.map(async u=>await tt(u)))}catch(t){return console.error("Error loading images:",t),[]}}static async loadUserImagesWithRetry(e,t=0,n=3){if(!e)return[];let s=0,o=[];for(;s<n&&(s>0&&await new Promise(u=>setTimeout(u,500*s)),o=await this.loadUserImages(e),!(o.length>t));)s++;return o}}var rr=M('<span class="loading loading-spinner loading-sm"></span> Uploading...',1),sr=Le('<svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg> Upload Photo',1),ar=M('<input type="file" accept="image/*" class="hidden"/> <div class="flex flex-col items-center space-y-4"><button class="btn w-full border-orange-500 bg-orange-500 text-white hover:bg-orange-600"><!></button> <button class="btn w-full border-red-500 bg-red-500 text-white hover:bg-red-600"><svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Slideshow</button></div>',1);function ir(r,e){me(e,!1);const[t,n]=be(),s=()=>O(p,"$uploading",t);let o=je(e,"user",8),u=je(e,"uploadedImages",12);const p=R(!1),y=R(u());y.subscribe(c=>{u(c)});let w=Be();function A(){ue(w)?.click()}async function D(c){const h=c.target,$=h.files;if(!(!$||$.length===0||!o())){p.set(!0);try{const g=$[0];if(!g.type.startsWith("image/")){alert("Please select an image file");return}const U=Date.now(),k=`${o().uid}/${U}_${g.name}`,G=Qe(et,`images/${k}`),F=await Wt(G,g),E=await tt(F.ref);y.set([...u(),E]);const V=await at.loadUserImagesWithRetry(o(),u().length-1);y.set(V)}catch(g){console.error("Upload failed:",g),alert("Upload failed. Please try again.")}finally{p.set(!1),h.value=""}}}Dt(()=>Gt(u()),()=>{y.set(u())}),Lt(),pe();var i=ar(),_=Je(i);zt(_,c=>qe(w,c),()=>ue(w));var d=b(_,2),m=f(d),x=f(m);{var L=c=>{var h=rr();le(),T(c,h)},N=c=>{var h=sr();le(),T(c,h)};j(x,c=>{s()?c(L):c(N,!1)})}v(m);var I=b(m,2);v(d),Y(()=>m.disabled=s()),z("change",_,D),z("click",m,A),z("click",I,()=>Kt("/slideshow")),T(r,i),he(),n()}class it{static async testGoogleSignIn(){const e=S.isNativePlatform(),t=S.getPlatform();return console.log("=== AUTH TEST START ==="),console.log("Platform:",t),console.log("Native:",e),console.log("User Agent:",navigator.userAgent.substring(0,100)),console.log("Firebase Config:",{projectId:a.app.options.projectId,authDomain:a.app.options.authDomain,apiKey:a.app.options.apiKey?.substring(0,10)+"..."}),e?await this.testNativeGoogleSignIn():await this.testWebGoogleSignIn()}static async testNativeGoogleSignIn(){try{if(console.log("--- Testing Native Google Sign-In ---"),console.log("Checking FirebaseAuthentication plugin availability..."),!C)throw new Error("FirebaseAuthentication plugin not available");console.log("Configuring plugin...");try{await C.configure({providers:["google.com"],skipNativeAuth:!1}),console.log("Plugin configured successfully")}catch(t){throw console.error("Configuration failed:",t),t}console.log("Checking current user...");try{const t=await C.getCurrentUser();console.log("Current user from plugin:",t)}catch(t){console.warn("Could not get current user:",t)}console.log("Attempting Google Sign-In...");const e=await C.signInWithGoogle();if(console.log("Plugin result:",{hasUser:!!e.user,userId:e.user?.uid,email:e.user?.email,credential:!!e.credential,additionalUserInfo:!!e.additionalUserInfo}),e.user){console.log("Native sign-in successful!");let t=0;for(;t<10&&!a.currentUser;)await new Promise(n=>setTimeout(n,500)),t++,console.log(`Waiting for Firebase Auth sync, attempt ${t}`);return console.log("Firebase Auth current user after sync:",{hasUser:!!a.currentUser,uid:a.currentUser?.uid,email:a.currentUser?.email}),{success:!0,method:"native",user:e.user,firebaseUser:a.currentUser,syncAttempts:t}}else return console.log("Native sign-in returned no user"),{success:!1,method:"native",error:"No user returned from plugin"}}catch(e){console.error("Native Google Sign-In failed:",e),console.log("Attempting web fallback for debugging...");try{return{...await this.testWebGoogleSignIn(),nativeError:e.message,method:"web-fallback-after-native-error"}}catch(t){return{success:!1,method:"native",error:e.message,webFallbackError:t.message}}}}static async testWebGoogleSignIn(){try{console.log("--- Testing Web Google Sign-In ---"),console.log("Google Provider config:",{providerId:Se.providerId,scopes:Se._config?.scopes||"unknown"}),console.log("Attempting popup sign-in...");const e=await jt(a,Se);return console.log("Web sign-in successful:",{uid:e.user.uid,email:e.user.email,displayName:e.user.displayName,providerId:e.providerId}),{success:!0,method:"web",user:e.user}}catch(e){return console.error("Web Google Sign-In failed:",e),{success:!1,method:"web",error:e.message,code:e.code}}}static checkAuthState(){return{hasCurrentUser:!!a.currentUser,user:a.currentUser?{uid:a.currentUser.uid,email:a.currentUser.email,displayName:a.currentUser.displayName,isAnonymous:a.currentUser.isAnonymous,providers:a.currentUser.providerData.map(e=>e.providerId)}:null,authConfig:{apiKey:a.app.options.apiKey?.substring(0,10)+"...",authDomain:a.app.options.authDomain,projectId:a.app.options.projectId},platform:{capacitor:S.getPlatform(),native:S.isNativePlatform(),userAgent:navigator.userAgent.substring(0,100)+"..."}}}static async testPluginAvailability(){try{if(console.log("Testing plugin availability..."),!C)return{available:!1,error:"FirebaseAuthentication plugin not found in global scope"};try{const e=await C.getCurrentUser();return{available:!0,currentUser:e.user?{uid:e.user.uid,email:e.user.email}:null,methods:Object.getOwnPropertyNames(C).filter(t=>typeof C[t]=="function")}}catch(e){return{available:!0,error:"Plugin exists but getCurrentUser failed: "+e.message,methods:Object.getOwnPropertyNames(C)}}}catch(e){return{available:!1,error:e.message}}}static async testMagicLink(e){try{console.log("Testing magic link for:",e);const{sendSignInLinkToEmail:t}=await Ge(async()=>{const{sendSignInLinkToEmail:s}=await import("../chunks/CUdqvLQw.js").then(o=>o.i);return{sendSignInLinkToEmail:s}},__vite__mapDeps([0,1,2]),import.meta.url),n={url:S.isNativePlatform()?"https://fototv-90cf0.firebaseapp.com/auth/callback":`${window.location.origin}/auth/callback`,handleCodeInApp:!0,android:{packageName:"com.phototv.app",installApp:!1,minimumVersion:"1"},ios:{bundleId:"com.phototv.app"}};return await t(a,e,n),{success:!0,method:"magic-link",email:e,message:"Magic link sent successfully"}}catch(t){return console.error("Magic link test failed:",t),{success:!1,method:"magic-link",error:t.message,code:t.code}}}static getDebugInfo(){const e={timestamp:new Date().toISOString(),platform:{capacitor:S.getPlatform(),native:S.isNativePlatform(),userAgent:navigator.userAgent},firebase:{projectId:a.app.options.projectId,authDomain:a.app.options.authDomain,hasCurrentUser:!!a.currentUser,currentUser:a.currentUser?{uid:a.currentUser.uid,email:a.currentUser.email,isAnonymous:a.currentUser.isAnonymous,providers:a.currentUser.providerData.map(t=>t.providerId)}:null},plugin:{available:!!C,methods:C?Object.getOwnPropertyNames(C):[]},storage:{hasWindow:typeof window<"u",hasLocalStorage:typeof window<"u"&&!!window.localStorage,storageMethod:S.isNativePlatform()?"in-memory":"localStorage"},environment:{dev:!1,mode:"production",hasFirebaseKeys:!0}};return console.log("=== DEBUG INFO ==="),console.log(JSON.stringify(e,null,2)),e}static async testConfiguration(){const e=[],t=await this.testPluginAvailability();return e.push({test:"Plugin Availability",passed:t.available,details:t}),e.push({test:"Firebase Configuration",passed:!!(a.app.options.projectId&&a.app.options.authDomain),details:{projectId:a.app.options.projectId,authDomain:a.app.options.authDomain,apiKey:a.app.options.apiKey?"Present":"Missing"}}),e.push({test:"Current User State",passed:!0,details:{hasUser:!!a.currentUser,user:a.currentUser?{uid:a.currentUser.uid,email:a.currentUser.email}:null}}),{success:e.every(s=>s.passed),summary:`${e.filter(s=>s.passed).length}/${e.length} tests passed`,results:e}}}typeof window<"u"&&(window.AuthTest=it);var nr=M('<span class="loading loading-spinner loading-sm mr-2"></span> Signing in...',1),or=Le('<svg class="mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g><path fill="#4285F4" d="M24 9.5c3.54 0 6.7 1.22 9.19 3.22l6.85-6.85C36.45 2.7 30.68 0 24 0 14.82 0 6.73 5.82 2.69 14.09l7.98 6.2C12.13 13.99 17.56 9.5 24 9.5z"></path><path fill="#34A853" d="M46.1 24.55c0-1.64-.15-3.22-.42-4.74H24v9.01h12.42c-.54 2.9-2.18 5.36-4.65 7.01l7.19 5.6C43.98 37.13 46.1 31.3 46.1 24.55z"></path><path fill="#FBBC05" d="M10.67 28.29c-1.13-3.36-1.13-6.97 0-10.33l-7.98-6.2C.7 15.32 0 19.56 0 24c0 4.44.7 8.68 2.69 12.24l7.98-6.2z"></path><path fill="#EA4335" d="M24 48c6.48 0 11.92-2.15 15.89-5.85l-7.19-5.6c-2.01 1.35-4.59 2.15-8.7 2.15-6.44 0-11.87-4.49-13.33-10.55l-7.98 6.2C6.73 42.18 14.82 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g></svg> Sign in with Google',1),lr=M('<span class="loading loading-spinner loading-sm"></span> Sending...',1),ur=Le('<svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> Send Magic Link',1),cr=M('<div class="space-y-3"><input type="email" placeholder="Enter your email" class="input input-bordered w-full"/> <button class="btn w-full border-blue-500 bg-blue-500 text-white hover:bg-blue-600"><!></button> <button class="btn btn-ghost w-full text-gray-600">Cancel</button></div>'),dr=M('<div class="space-y-1"><button class="btn w-full border-blue-500 bg-blue-500 text-white hover:bg-blue-600"><svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> Email Magic Link</button> <div class="text-center text-xs text-gray-500">no storage dependencies</div></div>'),gr=M("<div> </div>"),vr=M('<div class="space-y-4"><div class="space-y-1"><button class="btn w-full border-0 bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600"><!></button> <div class="text-center text-xs text-gray-500"> </div></div> <div class="flex items-center"><div class="flex-1 border-t border-gray-300"></div> <span class="px-3 text-sm text-gray-500">or</span> <div class="flex-1 border-t border-gray-300"></div></div> <!> <!> <!> <!></div>');function fr(r,e){me(e,!1);const[t,n]=be(),s=()=>O(_,"$loginInProgress",t),o=()=>O(A,"$email",t),u=()=>O(w,"$showEmailForm",t),p=()=>O(D,"$sending",t),y=()=>O(i,"$message",t),w=R(!1),A=R(""),D=R(!1),i=R(""),_=R(!1),d=R(""),m=S.isNativePlatform();async function x(){if(!s()){_.set(!0),i.set(""),d.set("Starting Google sign-in...");try{if(console.log("=== GOOGLE SIGN-IN START ==="),m){const l=await it.testGoogleSignIn();l.success?(i.set("Google Sign-In successful!"),d.set(`✅ Success via ${l.method}: ${l.user?.email||l.user?.uid}`),setTimeout(()=>{ae.getCurrentUser()&&d.set(`✅ Firebase Auth synced: ${ae.getCurrentUser()?.uid}`)},2e3)):(i.set(`Sign-in failed: ${l.error}`),d.set(`❌ Failed (${l.method}): ${l.error}`),l.nativeError&&l.webFallbackError&&d.set(`❌ Native: ${l.nativeError} | Web: ${l.webFallbackError}`))}else{const l=await ae.signInWithGoogle();l?(i.set("Google Sign-In successful!"),d.set(`✅ Web success: ${l.email||l.uid}`)):(i.set("Sign-in was cancelled"),d.set("❌ Web sign-in cancelled by user"))}}catch(l){console.error("Google login error:",l),i.set(`Sign-in failed: ${l.message||"Unknown error"}`),d.set(`❌ Exception: ${l.message} | Code: ${l.code||"unknown"}`)}finally{setTimeout(()=>{_.set(!1)},2e3)}}}async function L(){if(!o()){i.set("Please enter your email address");return}D.set(!0),i.set(""),d.set(`Sending magic link to ${o()}...`);try{await ae.sendMagicLink(o()),i.set("Check your email for the magic link!"),d.set(`✅ Magic link sent to ${o()}`),A.set("")}catch(l){console.error("Error sending magic link:",l),i.set("Error sending magic link. Please try again."),d.set(`❌ Magic link failed: ${l.message}`)}finally{D.set(!1)}}function N(){w.set(!u()),i.set(""),A.set(""),d.set("")}function I(){const l=ae.getDebugInfo();d.set(`Debug: Platform=${l.platform.native?"Native":"Web"}, Plugin=${l.plugin.available?"Yes":"No"}, Firebase=${l.firebase.hasCurrentUser?"Signed In":"Not signed in"}, Storage=${l.storage.storageMethod}`),console.log("Full debug info:",l)}_e(async()=>{I()}),pe();var c=vr(),h=f(c),$=f(h),g=f($);{var U=l=>{var P=nr();le(),T(l,P)},k=l=>{var P=or();le(),T(l,P)};j(g,l=>{s()?l(U):l(k,!1)})}v($);var G=b($,2),F=f(G,!0);v(G),v(h);var E=b(h,4);{var V=l=>{var P=cr(),H=f(P);Xe(H);var te=b(H,2),ye=f(te);{var xe=B=>{var ge=lr();le(),T(B,ge)},Ie=B=>{var ge=ur();le(),T(B,ge)};j(ye,B=>{p()?B(xe):B(Ie,!1)})}v(te);var de=b(te,2);v(P),Y(()=>{H.disabled=p(),te.disabled=p()}),st(H,o,B=>Ze(A,B)),z("click",te,L),z("click",de,N),T(l,P)},X=l=>{var P=dr(),H=f(P);le(2),v(P),z("click",H,N),T(l,P)};j(E,l=>{u()?l(V):l(X,!1)})}var q=b(E,2);{var Z=l=>{var P=gr(),H=f(P,!0);v(P),Y(te=>{we(P,1,`text-center text-sm ${te??""}`),J(H,y())},[()=>y().includes("failed")||y().includes("Error")?"text-red-600":"text-green-600"]),T(l,P)};j(q,l=>{y()&&l(Z)})}var W=b(q,2);j(W,l=>{});var Q=b(W,2);j(Q,l=>{}),v(c),Y(()=>{$.disabled=s(),J(F,m?"uses native authentication":"uses web popup")}),z("click",$,x),T(r,c),he(),n()}var oe=tr(()=>ae),pr=M('<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50" style="backdrop-filter: blur(3px);"><div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full mx-4"><div class="flex flex-col items-center"><div class="loading loading-spinner loading-lg text-orange-500 mb-4"></div> <h3 class="text-lg font-semibold mb-2"> </h3> <p class="text-sm text-gray-600 mb-4">Please complete authentication in your browser. This window will close automatically.</p> <div class="w-full bg-gray-200 rounded-full h-2 mb-2"><div class="bg-orange-500 h-2 rounded-full transition-all duration-300"></div></div> <p class="text-xs text-gray-500"> </p> <button class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 text-sm">Cancel</button></div></div></div>');function mr(r,e){me(e,!1);const[t,n]=be(),s=()=>O(p,"$isRedirecting",t),o=()=>O(y,"$message",t),u=()=>O(w,"$redirectTimer",t),p=R(!1),y=R(""),w=R(0),A=120,D=S.isNativePlatform();let i=null,_=null;function d(){p.set(!0),y.set("Waiting for authentication..."),w.set(0),i&&clearInterval(i),i=setInterval(()=>{w.update(c=>c>=A?(y.set("Authentication timed out. Please try again."),p.set(!1),clearInterval(i),0):c+1)},1e3)}function m(){i&&(clearInterval(i),i=null),p.set(!1),w.set(0)}function x(){return _=async()=>{document.visibilityState==="visible"&&s()&&(y.set("Returning from authentication provider..."),setTimeout(async()=>{try{(a.currentUser||await oe().handleRedirectResult())&&(y.set("Authentication successful!"),m())}catch(c){console.error("Auth visibility check error:",c)}},1e3))},document.addEventListener("visibilitychange",_),a.onAuthStateChanged(c=>{c&&s()&&(y.set("Authentication successful!"),m())})}_e(()=>{const c=x(),h=oe().signInWithGoogle;return oe(oe().signInWithGoogle=async function(...$){return D&&d(),h.apply(oe(),$)}),()=>{c&&c(),oe(oe().signInWithGoogle=h)}}),Rt(()=>{i&&clearInterval(i),_&&document.removeEventListener("visibilitychange",_)}),pe();var L=Ft(),N=Je(L);{var I=c=>{var h=pr(),$=f(h),g=f($),U=b(f(g),2),k=f(U,!0);v(U);var G=b(U,4),F=f(G);v(G);var E=b(G,2),V=f(E);v(E);var X=b(E,2);v(g),v($),v(h),Y(q=>{J(k,o()),er(F,`width: ${u()/A*100}%`),J(V,`${q??""} seconds remaining`)},[()=>Math.max(0,A-u())]),z("click",X,()=>m()),T(c,h)};j(N,c=>{s()&&c(I)})}T(r,L),he(),n()}const fe=R([]);function se(r,e){const n=`[${new Date().toISOString().split("T")[1].split(".")[0]}] ${r}`;e?(console.log(n,e),fe.update(s=>[...s,`${n} ${JSON.stringify(e,null,2)}`].slice(-50))):(console.log(n),fe.update(s=>[...s,n].slice(-50)))}function Re(){return{platform:S.getPlatform(),isNative:S.isNativePlatform(),userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",currentAuthState:a.currentUser?{uid:a.currentUser.uid,email:a.currentUser.email,isAnonymous:a.currentUser.isAnonymous,providerIds:a.currentUser.providerData.map(r=>r.providerId)}:"Not authenticated",capacitorConfig:S.config}}function hr(){a.onAuthStateChanged(e=>{e?se("Auth state changed: SIGNED IN",{uid:e.uid,email:e.email,providers:e.providerData.map(t=>t.providerId)}):se("Auth state changed: SIGNED OUT")});const r=console.error;console.error=function(...e){e[0]&&typeof e[0]=="string"&&(e[0].includes("auth")||e[0].includes("firebase"))&&se("AUTH ERROR:",e),r.apply(console,e)};try{S.isNativePlatform()&&Ge(async()=>{const{App:e}=await Promise.resolve().then(()=>Ir);return{App:e}},void 0,import.meta.url).then(({App:e})=>{e.addListener("appUrlOpen",t=>{se("App URL opened",{url:t.url})}),e.addListener("appStateChange",t=>{se("App state changed",{isActive:t.isActive})})})}catch(e){se("Could not set up Capacitor App listeners",e)}se("Auth debug listeners set up",Re())}typeof window<"u"&&(window.authDebug={log:se,getInfo:Re,getAuthState:()=>a.currentUser,getAllLogs:()=>{let r=[];return fe.subscribe(e=>{r=e})(),r}});hr();var br=M('<div class="mt-2 rounded bg-gray-700 p-2 text-xs"> </div>'),yr=M('<div class="py-1"> </div>'),wr=M('<div class="mt-4 h-[80vh] w-[90vw] max-w-lg overflow-auto rounded-lg bg-gray-800 p-4 text-white shadow-xl"><div class="flex items-center justify-between"><h2 class="text-xl font-bold">Auth Debug</h2> <button class="rounded bg-red-600 px-2 py-1 text-sm text-white hover:bg-red-700">Close</button></div> <div class="mt-4"><div class="flex justify-between"><h3 class="text-lg font-semibold">Platform Info</h3> <button class="rounded bg-blue-600 px-2 py-1 text-xs text-white hover:bg-blue-700">Refresh</button></div> <div class="mt-2 rounded bg-gray-700 p-2 text-xs"><pre> </pre></div></div> <div class="mt-4"><h3 class="text-lg font-semibold">Test Auth</h3> <div class="mt-2 flex flex-col space-y-2"><button class="rounded bg-blue-600 px-3 py-2 text-sm text-white hover:bg-blue-700">Test Google Sign-In</button> <div class="flex space-x-2"><input type="email" placeholder="test@example.com" class="flex-1 rounded border border-gray-600 bg-gray-700 px-3 py-2 text-sm text-white"/> <button class="rounded bg-blue-600 px-3 py-2 text-sm text-white hover:bg-blue-700">Test Magic Link</button></div> <button class="rounded bg-red-600 px-3 py-2 text-sm text-white hover:bg-red-700">Sign Out</button> <!></div></div> <div class="mt-4"><div class="flex justify-between"><h3 class="text-lg font-semibold">Debug Logs</h3> <button class="rounded bg-red-600 px-2 py-1 text-xs text-white hover:bg-red-700">Clear</button></div> <div class="mt-2 h-[30vh] overflow-auto rounded bg-gray-700 p-2 text-xs"></div></div> <div class="mt-4 text-xs text-gray-400"><p>Debug Version: 1.0.0</p> <p> </p> <p> </p></div></div>'),_r=M('<div class="fixed bottom-4 right-4 z-50"><button class="rounded-full bg-gray-800 p-3 text-white shadow-lg hover:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button> <!></div>');function xr(r,e){me(e,!1);const[t,n]=be(),s=()=>O(D,"$testEmail",t),o=()=>O(w,"$showDebug",t),u=()=>O(A,"$platformInfo",t),p=()=>O(i,"$testResult",t),y=()=>O(fe,"$authDebugLog",t),w=R(!1),A=R({}),D=R(""),i=R("");function _(){w.update(g=>!g)}function d(){fe.set([])}function m(){A.set(Re())}async function x(){i.set("Testing Google Sign-In...");try{await ae.signInWithGoogle(),i.set("Google Sign-In initiated successfully")}catch(g){i.set(`Error: ${g.message||"Unknown error"}`),console.error("Google Sign-In Test Error:",g)}}async function L(){if(!s()){i.set("Please enter an email address");return}i.set(`Sending magic link to ${s()}...`);try{await ae.sendMagicLink(s()),i.set(`Magic link sent to ${s()}`)}catch(g){i.set(`Error: ${g.message||"Unknown error"}`),console.error("Magic Link Test Error:",g)}}async function N(){i.set("Signing out...");try{await a.signOut(),i.set("Signed out successfully")}catch(g){i.set(`Error: ${g.message||"Unknown error"}`)}}_e(()=>{m()}),pe();var I=_r(),c=f(I),h=b(c,2);{var $=g=>{var U=wr(),k=f(U),G=b(f(k),2);v(k);var F=b(k,2),E=f(F),V=b(f(E),2);v(E);var X=b(E,2),q=f(X),Z=f(q,!0);v(q),v(X),v(F);var W=b(F,2),Q=b(f(W),2),l=f(Q),P=b(l,2),H=f(P);Xe(H);var te=b(H,2);v(P);var ye=b(P,2),xe=b(ye,2);{var Ie=re=>{var ie=br(),ne=f(ie,!0);v(ie),Y(()=>J(ne,p())),T(re,ie)};j(xe,re=>{p()&&re(Ie)})}v(Q),v(W);var de=b(W,2),B=f(de),ge=b(f(B),2);v(B);var Me=b(B,2);Jt(Me,5,y,Yt,(re,ie)=>{var ne=yr(),ut=f(ne,!0);v(ne),Y(()=>J(ut,ue(ie))),T(re,ne)}),v(Me),v(de);var ze=b(de,2),Ae=b(f(ze),2),ot=f(Ae);v(Ae);var Oe=b(Ae,2),lt=f(Oe);v(Oe),v(ze),v(U),Y((re,ie,ne)=>{J(Z,re),J(ot,`Platform: ${ie??""}`),J(lt,`Is Native: ${ne??""}`)},[()=>JSON.stringify(u(),null,2),()=>S.getPlatform(),()=>S.isNativePlatform()?"Yes":"No"]),z("click",G,()=>w.set(!1)),z("click",V,m),z("click",l,x),st(H,s,re=>Ze(D,re)),z("click",te,L),z("click",ye,N),z("click",ge,d),T(g,U)};j(h,g=>{o()&&g($)})}v(I),z("click",c,_),T(r,I),he(),n()}const nt=Vt("App",{web:()=>Ge(()=>import("../chunks/DPN3YqL6.js"),__vite__mapDeps([3,2]),import.meta.url).then(r=>new r.AppWeb)}),Ir=Object.freeze(Object.defineProperty({__proto__:null,App:nt},Symbol.toStringTag,{value:"Module"}));class Fe{static initialized=!1;static authInProgress=!1;static async initialize(){if(!(this.initialized||!S.isNativePlatform())){console.log("🤖 Initializing AndroidAuth for production APK");try{await C.configure({providers:["google.com"],skipNativeAuth:!1,android:{serverClientId:"341116492373-943d7474frnl1n9uv4rf16lfg1oprn4o.apps.googleusercontent.com"}}),console.log("✅ Firebase Authentication plugin configured"),a.onAuthStateChanged(e=>{e?console.log("🔓 User authenticated:",{uid:e.uid,email:e.email,providers:e.providerData.map(t=>t.providerId)}):console.log("🔒 User signed out")}),nt.addListener("appUrlOpen",e=>{console.log("📱 App opened with URL:",e.url)}),this.initialized=!0,console.log("🚀 AndroidAuth initialization complete")}catch(e){throw console.error("❌ Failed to initialize AndroidAuth:",e),new Error(`Android authentication setup failed: ${e.message}`)}}}static async signInWithGoogle(){if(!S.isNativePlatform())throw new Error("AndroidAuth is only for native Android platform");if(this.authInProgress)return console.log("🔄 Authentication already in progress, skipping..."),null;this.authInProgress=!0;try{console.log("🚀 Starting Google Sign-In for Android"),this.initialized||await this.initialize();const e=await this.getCurrentUser();if(e)return console.log("✅ User already signed in:",e.uid),e;console.log("📱 Calling native Google Sign-In...");const t=await C.signInWithGoogle();if(console.log("📋 Native sign-in result:",{hasUser:!!t.user,hasCredential:!!t.credential,userId:t.user?.uid,email:t.user?.email,providerId:t.user?.providerId}),!t.user)return console.log("❌ No user returned - likely cancelled by user"),null;console.log("✅ Google Sign-In successful:",t.user.uid);let n=0;const s=20;for(;n<s;){if(a.currentUser&&a.currentUser.uid===t.user.uid){console.log(`✅ Firebase Auth synced after ${n*500}ms`);break}await new Promise(o=>setTimeout(o,500)),n++,n%4===0&&console.log(`⏳ Still waiting for Firebase Auth sync... (${n*500}ms)`)}return a.currentUser?a.currentUser:(console.warn("⚠️ Firebase Auth did not sync, but plugin returned user"),t.user)}catch(e){if(console.error("❌ Google Sign-In failed:",e),e.message?.includes("DEVELOPER_ERROR"))throw new Error("Google Sign-In configuration error. Check that Google Play certificates are added to Firebase Console.");if(e.message?.includes("SIGN_IN_CANCELLED"))return console.log("ℹ️ Sign-in cancelled by user"),null;throw e.message?.includes("NETWORK_ERROR")?new Error("Network error. Please check your internet connection and try again."):new Error(`Google Sign-In failed: ${e.message}`)}finally{this.authInProgress=!1}}static async getCurrentUser(){try{if(a.currentUser)return a.currentUser;if(this.initialized){const e=await C.getCurrentUser();if(e.user)return console.log("Found user in plugin but not in Firebase Auth"),await new Promise(t=>setTimeout(t,1e3)),a.currentUser||e.user}return null}catch(e){return console.error("Error getting current user:",e),a.currentUser}}static async signOut(){try{if(console.log("🚪 Signing out user..."),this.initialized)try{await C.signOut(),console.log("✅ Signed out from Firebase Authentication plugin")}catch(e){console.warn("⚠️ Plugin sign out failed:",e)}await a.signOut(),console.log("✅ Signed out from Firebase Auth")}catch(e){throw console.error("❌ Sign out error:",e),e}}static isSignedIn(){return!!a.currentUser}static async getAuthToken(){try{const e=a.currentUser;return e?await e.getIdToken():null}catch(e){return console.error("Error getting auth token:",e),null}}static async testConfiguration(){const e={platform:S.getPlatform(),isNative:S.isNativePlatform(),pluginAvailable:!!C,initialized:this.initialized,currentUser:null,firebaseConfig:{projectId:a.app.options.projectId,authDomain:a.app.options.authDomain}},t=[];try{if(!S.isNativePlatform())return t.push("This service is designed for Android native apps only"),{success:!1,details:e,recommendations:t};if(!C)return t.push("FirebaseAuthentication plugin not available"),{success:!1,details:e,recommendations:t};this.initialized||await this.initialize();try{const s=await C.getCurrentUser();e.pluginUser=s.user?{uid:s.user.uid,email:s.user.email}:null}catch(s){e.pluginUserError=s.message,t.push("Cannot get current user from plugin")}e.currentUser=a.currentUser?{uid:a.currentUser.uid,email:a.currentUser.email,isAnonymous:a.currentUser.isAnonymous}:null;const n=this.initialized&&!!C;return n?(t.push("Configuration looks good!"),e.currentUser||t.push("Try signing in with Google to test authentication")):(t.push("Plugin initialization failed"),t.push("Check that @capacitor-firebase/authentication is properly installed"),t.push("Ensure google-services.json is in android/app/ directory"),t.push("Verify Google Play certificates are added to Firebase Console")),{success:n,details:e,recommendations:t}}catch(n){return e.error=n.message,t.push(`Initialization failed: ${n.message}`),t.push("Check Firebase project configuration and plugin installation"),{success:!1,details:e,recommendations:t}}}static getDebugInfo(){return{service:"AndroidAuth",timestamp:new Date().toISOString(),platform:{capacitor:S.getPlatform(),native:S.isNativePlatform(),userAgent:navigator.userAgent.substring(0,100)+"..."},authentication:{initialized:this.initialized,authInProgress:this.authInProgress,pluginAvailable:!!C,currentUser:a.currentUser?{uid:a.currentUser.uid,email:a.currentUser.email,isAnonymous:a.currentUser.isAnonymous,providers:a.currentUser.providerData.map(e=>e.providerId)}:null},firebase:{projectId:a.app.options.projectId,authDomain:a.app.options.authDomain,appId:a.app.options.appId},storage:{method:"in-memory-only",emailStored:!!emailForSignIn},recommendations:["This is an Android-only authentication service","Magic links use custom URL scheme: com.phototv.app://auth/callback","Google Sign-In uses native Android integration","No web dependencies or localStorage usage"]}}}S.isNativePlatform()&&S.getPlatform()==="android"&&Fe.initialize().catch(r=>{console.error("Failed to auto-initialize AndroidAuth:",r)});typeof window<"u"&&(window.AndroidAuth=Fe);var Ar=M('<div class="avatar"><div class="h-8 w-8 rounded-full ring ring-orange-500 ring-offset-1 ring-offset-white"><img alt="User avatar"/></div></div>'),Ur=M('<div class="flex h-8 w-8 items-center justify-center rounded-full bg-orange-500 ring ring-orange-500 ring-offset-1 ring-offset-white"><span class="text-sm font-semibold text-white"> </span></div>'),$r=M('<div class="absolute top-4 right-4 z-10 flex items-center space-x-2"><!> <div class="text-sm text-gray-800"><span class="font-semibold"> </span></div> <button class="btn btn-sm ml-2 border-white bg-white text-gray-700 hover:bg-gray-100">Logout</button></div>'),kr=M('<div class="relative flex min-h-screen flex-col items-center justify-center bg-gradient-to-br from-orange-100 to-red-100 p-4"><!> <div><div class="flex items-center space-x-3"><img src="/FotoTV-logo2.png" alt="FotoTV Logo"/> <h1>FotoTV</h1></div></div> <div class="w-full max-w-md"><!></div> <!> <!> <!></div>');function Mr(r,e){me(e,!1);const[t,n]=be(),s=()=>O(u,"$user",t),o=()=>O(p,"$uploadedImages",t),u=R(null),p=R([]);_e(async()=>{if(S.isNativePlatform())try{await Fe.initialize(),console.log("AndroidAuth initialized successfully")}catch(U){console.error("Failed to initialize AndroidAuth:",U)}return Ht(a,async U=>{if(u.set(U),U){const k=await at.loadUserImages(U);p.set(k)}else p.set([])})});function y(){Bt(a).catch(console.error)}pe();var w=kr(),A=f(w);{var D=g=>{var U=$r(),k=f(U);{var G=Z=>{var W=Ar(),Q=f(W),l=f(Q);v(Q),v(W),Y(()=>Mt(l,"src",s().photoURL)),T(Z,W)},F=Z=>{var W=Ur(),Q=f(W),l=f(Q,!0);v(Q),v(W),Y(P=>J(l,P),[()=>s().displayName?s().displayName.charAt(0).toUpperCase():s().email?.charAt(0).toUpperCase()||"U"]),T(Z,W)};j(k,Z=>{s().photoURL?Z(G):Z(F,!1)})}var E=b(k,2),V=f(E),X=f(V,!0);v(V),v(E);var q=b(E,2);v(U),Y(()=>J(X,s().displayName||s().email)),z("click",q,y),T(g,U)};j(A,g=>{s()&&g(D)})}var i=b(A,2),_=f(i),d=f(_),m=b(d,2);v(_),v(i);var x=b(i,2),L=f(x);{var N=g=>{ir(g,{get user(){return s()},get uploadedImages(){return o()}})},I=g=>{fr(g,{})};j(L,g=>{s()?g(N):g(I,!1)})}v(x);var c=b(x,2);j(c,g=>{});var h=b(c,2);xr(h,{});var $=b(h,2);mr($,{}),v(w),Y(()=>{we(i,1,`${s()?"absolute top-4 left-4":"absolute top-8 left-1/2 -translate-x-1/2 transform"} z-10`),we(d,1,`${s()?"h-8":"h-16"} w-auto`),we(m,1,`${s()?"text-lg":"text-3xl"} font-bold text-gray-800`)}),T(r,w),he(),n()}export{Mr as component};
