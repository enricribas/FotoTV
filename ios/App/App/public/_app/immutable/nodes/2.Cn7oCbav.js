const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/C13OeFrB.js","../chunks/xY4BzElm.js","../chunks/D9Z9MdNV.js"])))=>i.map(i=>d[i]);
import"../chunks/NZTpNUN0.js";import{i as Se}from"../chunks/DmtWXkJs.js";import{x as He,q as ue,am as Bt,z as mt,u as qt,l as Ht,g as w,a3 as Wt,v as Yt,H as Gt,w as it,y as We,G as Ee,an as jt,ao as zt,A as Ke,C as Jt,B as be,ap as yt,aq as Xt,m as se,ar as lt,as as Kt,D as bt,F as Qt,at as Zt,au as Ye,av as wt,aw as er,ax as tr,ay as rr,az as ar,aA as sr,aB as nr,a6 as or,aC as ir,aD as lr,J as Ve,W as cr,p as Pe,f as D,h,d,r as c,n as ve,t as B,e as W,s as $,b as E,c as Ne,T as X,k as _t,aE as dr,aF as ur,j as Ie,aG as xt,Q as vr,o as At,a as fr,i as Tt}from"../chunks/xY4BzElm.js";import{i as q}from"../chunks/37DlUv7F.js";import{r as Et,s as Ct,l as pr,g as kt,_ as gr,C as hr,c as ct,e as mr,f as yr,h as br,i as tt,j as wr,k as _r,p as xr,u as Ar,F as Tr,m as Er,n as Ge,q as Ce,t as Cr,v as dt,w as je,x as ut,y as Le,z as vt,T as ft,A as kr,a as Q,B as we,D as Ir,E as Sr,G as Pr,H as Nr,I as Dr,o as Ur,J as Lr,b as Vr}from"../chunks/BliC9dKz.js";import{s as he,i as Mr,a as Or}from"../chunks/C13OeFrB.js";import{p as Qe,b as Fr,s as ae,a as rt,c as ke}from"../chunks/jadGjtFd.js";import{w as z}from"../chunks/tXywwJjX.js";import{g as Rr}from"../chunks/DHVU9EpJ.js";import{_ as $r}from"../chunks/D9Z9MdNV.js";function Br(a,t){return t}function qr(a,t,e){for(var r=a.items,s=[],n=t.length,o=0;o<n;o++)ar(t[o].e,s,!0);var i=n>0&&s.length===0&&e!==null;if(i){var f=e.parentNode;sr(f),f.append(e),r.clear(),ie(a,t[0].prev,t[n-1].next)}nr(s,()=>{for(var l=0;l<n;l++){var u=t[l];i||(r.delete(u.k),ie(a,u.prev,u.next)),wt(u.e,!i)}})}function Hr(a,t,e,r,s,n=null){var o=a,i={flags:t,items:new Map,first:null};{var f=a;o=ue?He(Bt(f)):f.appendChild(mt())}ue&&qt();var l=null,u=!1,V=new Map,g=Wt(()=>{var A=e();return Xt(A)?A:A==null?[]:yt(A)}),_,y;function p(){Wr(y,_,i,V,o,s,t,r,e),n!==null&&(_.length===0?l?bt(l):l=Ke(()=>n(o)):l!==null&&Qt(l,()=>{l=null}))}Ht(()=>{y??=or,_=w(g);var A=_.length;if(u&&A===0)return;u=A===0;let L=!1;if(ue){var F=Yt(o)===Gt;F!==(A===0)&&(o=it(),He(o),We(!1),L=!0)}if(ue){for(var C=null,M,P=0;P<A;P++){if(Ee.nodeType===jt&&Ee.data===zt){o=Ee,L=!0,We(!1);break}var b=_[P],v=r(b,P);M=Ze(Ee,i,C,null,b,v,P,s,t,e),i.items.set(v,M),C=M}A>0&&He(it())}if(ue)A===0&&n&&(l=Ke(()=>n(o)));else if(Jt()){var m=new Set,N=be;for(P=0;P<A;P+=1){b=_[P],v=r(b,P);var T=i.items.get(v)??V.get(v);T?It(T,b,P):(M=Ze(null,i,null,null,b,v,P,s,t,e,!0),V.set(v,M)),m.add(v)}for(const[x,k]of i.items)m.has(x)||N.skipped_effects.add(k.e);N.add_callback(p)}else p();L&&We(!0),w(g)}),ue&&(o=Ee)}function Wr(a,t,e,r,s,n,o,i,f){var l=t.length,u=e.items,V=e.first,g=V,_,y=null,p=[],A=[],L,F,C,M;for(M=0;M<l;M+=1){if(L=t[M],F=i(L,M),C=u.get(F),C===void 0){var P=r.get(F);if(P!==void 0){r.delete(F),u.set(F,P);var b=y?y.next:g;ie(e,y,P),ie(e,P,b),ze(P,b,s),y=P}else{var v=g?g.e.nodes_start:s;y=Ze(v,e,y,y===null?e.first:y.next,L,F,M,n,o,f)}u.set(F,y),p=[],A=[],g=y.next;continue}if(It(C,L,M),(C.e.f&Ye)!==0&&bt(C.e),C!==g){if(_!==void 0&&_.has(C)){if(p.length<A.length){var m=A[0],N;y=m.prev;var T=p[0],x=p[p.length-1];for(N=0;N<p.length;N+=1)ze(p[N],m,s);for(N=0;N<A.length;N+=1)_.delete(A[N]);ie(e,T.prev,x.next),ie(e,y,T),ie(e,x,m),g=m,y=x,M-=1,p=[],A=[]}else _.delete(C),ze(C,g,s),ie(e,C.prev,C.next),ie(e,C,y===null?e.first:y.next),ie(e,y,C),y=C;continue}for(p=[],A=[];g!==null&&g.k!==F;)(g.e.f&Ye)===0&&(_??=new Set).add(g),A.push(g),g=g.next;if(g===null)continue;C=g}p.push(C),y=C,g=C.next}if(g!==null||_!==void 0){for(var k=_===void 0?[]:yt(_);g!==null;)(g.e.f&Ye)===0&&k.push(g),g=g.next;var I=k.length;if(I>0){var Y=l===0?s:null;qr(e,k,Y)}}a.first=e.first&&e.first.e,a.last=y&&y.e;for(var R of r.values())wt(R.e);r.clear()}function It(a,t,e,r){Kt(a.v,t),a.i=e}function Ze(a,t,e,r,s,n,o,i,f,l,u){var V=(f&er)!==0,g=(f&tr)===0,_=V?g?se(s,!1,!1):lt(s):s,y=(f&Zt)===0?o:lt(o),p={i:y,v:_,k:n,a:null,e:null,prev:e,next:r};try{if(a===null){var A=document.createDocumentFragment();A.append(a=mt())}return p.e=Ke(()=>i(a,_,y,l),ue),p.e.prev=e&&e.e,p.e.next=r&&r.e,e===null?u||(t.first=p):(e.next=p,e.e.next=p.e),r!==null&&(r.prev=p,r.e.prev=p.e),p}finally{}}function ze(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,s=t?t.e.nodes_start:e,n=a.e.nodes_start;n!==null&&n!==r;){var o=rr(n);s.before(n),n=o}}function ie(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function _e(a,t,e=t){var r=ir(),s=new WeakSet;lr(a,"input",n=>{var o=n?a.defaultValue:a.value;if(o=Je(a)?Xe(o):o,e(o),be!==null&&s.add(be),r&&o!==(o=t())){var i=a.selectionStart,f=a.selectionEnd;a.value=o??"",f!==null&&(a.selectionStart=i,a.selectionEnd=Math.min(f,a.value.length))}}),(ue&&a.defaultValue!==a.value||Ve(t)==null&&a.value)&&(e(Je(a)?Xe(a.value):a.value),be!==null&&s.add(be)),cr(()=>{var n=t();a===document.activeElement&&s.has(be)||Je(a)&&n===Xe(a.value)||a.type==="date"&&!n&&!a.value||n!==a.value&&(a.value=n??"")})}function Je(a){var t=a.type;return t==="number"||t==="range"}function Xe(a){return a===""?null:+a}function Yr(a){return function(...t){var e=t[0];return e.preventDefault(),a?.apply(this,t)}}class St{static async loadUserImages(t){if(!t)return[];try{const e=Et(Ct,`images/${t.uid}`),s=(await pr(e)).items.sort((o,i)=>o.name.localeCompare(i.name));return await Promise.all(s.map(async o=>await kt(o)))}catch(e){return console.error("Error loading images:",e),[]}}static async loadUserImagesWithRetry(t,e=0,r=3){if(!t)return[];let s=0,n=[];for(;s<r&&(s>0&&await new Promise(o=>setTimeout(o,500*s)),n=await this.loadUserImages(t),!(n.length>e));)s++;return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gr="type.googleapis.com/google.protobuf.Int64Value",jr="type.googleapis.com/google.protobuf.UInt64Value";function Pt(a,t){const e={};for(const r in a)a.hasOwnProperty(r)&&(e[r]=t(a[r]));return e}function Me(a){if(a==null)return null;if(a instanceof Number&&(a=a.valueOf()),typeof a=="number"&&isFinite(a)||a===!0||a===!1||Object.prototype.toString.call(a)==="[object String]")return a;if(a instanceof Date)return a.toISOString();if(Array.isArray(a))return a.map(t=>Me(t));if(typeof a=="function"||typeof a=="object")return Pt(a,t=>Me(t));throw new Error("Data cannot be encoded in JSON: "+a)}function xe(a){if(a==null)return a;if(a["@type"])switch(a["@type"]){case Gr:case jr:{const t=Number(a.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+a);return t}default:throw new Error("Data cannot be decoded from JSON: "+a)}return Array.isArray(a)?a.map(t=>xe(t)):typeof a=="function"||typeof a=="object"?Pt(a,t=>xe(t)):a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const at="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends Tr{constructor(t,e,r){super(`${at}/${t}`,e||""),this.details=r,Object.setPrototypeOf(this,Z.prototype)}}function zr(a){if(a>=200&&a<300)return"ok";switch(a){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Oe(a,t){let e=zr(a),r=e,s;try{const n=t&&t.error;if(n){const o=n.status;if(typeof o=="string"){if(!pt[o])return new Z("internal","internal");e=pt[o],r=o}const i=n.message;typeof i=="string"&&(r=i),s=n.details,s!==void 0&&(s=xe(s))}}catch{}return e==="ok"?null:new Z(e,r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(t,e,r,s){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,mr(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=e.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||e.get().then(n=>this.auth=n,()=>{}),this.messaging||r.get().then(n=>this.messaging=n,()=>{}),this.appCheck||s?.get().then(n=>this.appCheck=n,()=>{})}async getAuthToken(){if(this.auth)try{const t=await this.auth.getToken();return t?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const e=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(t){const e=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(t);return{authToken:e,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const et="us-central1",Xr=/^data: (.*?)(?:\n|$)/;function Kr(a){let t=null;return{promise:new Promise((e,r)=>{t=setTimeout(()=>{r(new Z("deadline-exceeded","deadline-exceeded"))},a)}),cancel:()=>{t&&clearTimeout(t)}}}class Qr{constructor(t,e,r,s,n=et,o=(...i)=>fetch(...i)){this.app=t,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new Jr(t,e,r,s),this.cancelAllRequests=new Promise(i=>{this.deleteService=()=>Promise.resolve(i())});try{const i=new URL(n);this.customDomain=i.origin+(i.pathname==="/"?"":i.pathname),this.region=et}catch{this.customDomain=null,this.region=n}}_delete(){return this.deleteService()}_url(t){const e=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${e}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${e}.cloudfunctions.net/${t}`}}function Zr(a,t,e){const r=_r(t);a.emulatorOrigin=`http${r?"s":""}://${t}:${e}`,r&&(xr(a.emulatorOrigin),Ar("Functions",!0))}function ea(a,t,e){const r=s=>ra(a,t,s,{});return r.stream=(s,n)=>sa(a,t,s,n),r}async function ta(a,t,e,r){e["Content-Type"]="application/json";let s;try{s=await r(a,{method:"POST",body:JSON.stringify(t),headers:e})}catch{return{status:0,json:null}}let n=null;try{n=await s.json()}catch{}return{status:s.status,json:n}}async function Nt(a,t){const e={},r=await a.contextProvider.getContext(t.limitedUseAppCheckTokens);return r.authToken&&(e.Authorization="Bearer "+r.authToken),r.messagingToken&&(e["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(e["X-Firebase-AppCheck"]=r.appCheckToken),e}function ra(a,t,e,r){const s=a._url(t);return aa(a,s,e,r)}async function aa(a,t,e,r){e=Me(e);const s={data:e},n=await Nt(a,r),o=r.timeout||7e4,i=Kr(o),f=await Promise.race([ta(t,s,n,a.fetchImpl),i.promise,a.cancelAllRequests]);if(i.cancel(),!f)throw new Z("cancelled","Firebase Functions instance was deleted.");const l=Oe(f.status,f.json);if(l)throw l;if(!f.json)throw new Z("internal","Response is not valid JSON object.");let u=f.json.data;if(typeof u>"u"&&(u=f.json.result),typeof u>"u")throw new Z("internal","Response is missing data field.");return{data:xe(u)}}function sa(a,t,e,r){const s=a._url(t);return na(a,s,e,r||{})}async function na(a,t,e,r){var s;e=Me(e);const n={data:e},o=await Nt(a,r);o["Content-Type"]="application/json",o.Accept="text/event-stream";let i;try{i=await a.fetchImpl(t,{method:"POST",body:JSON.stringify(n),headers:o,signal:r?.signal})}catch(_){if(_ instanceof Error&&_.name==="AbortError"){const p=new Z("cancelled","Request was cancelled.");return{data:Promise.reject(p),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(p)}}}}}}const y=Oe(0,null);return{data:Promise.reject(y),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(y)}}}}}}let f,l;const u=new Promise((_,y)=>{f=_,l=y});(s=r?.signal)===null||s===void 0||s.addEventListener("abort",()=>{const _=new Z("cancelled","Request was cancelled.");l(_)});const V=i.body.getReader(),g=oa(V,f,l,r?.signal);return{stream:{[Symbol.asyncIterator](){const _=g.getReader();return{async next(){const{value:y,done:p}=await _.read();return{value:y,done:p}},async return(){return await _.cancel(),{done:!0,value:void 0}}}}},data:u}}function oa(a,t,e,r){const s=(o,i)=>{const f=o.match(Xr);if(!f)return;const l=f[1];try{const u=JSON.parse(l);if("result"in u){t(xe(u.result));return}if("message"in u){i.enqueue(xe(u.message));return}if("error"in u){const V=Oe(0,u);i.error(V),e(V);return}}catch(u){if(u instanceof Z){i.error(u),e(u);return}}},n=new TextDecoder;return new ReadableStream({start(o){let i="";return f();async function f(){if(r?.aborted){const l=new Z("cancelled","Request was cancelled");return o.error(l),e(l),Promise.resolve()}try{const{value:l,done:u}=await a.read();if(u){i.trim()&&s(i.trim(),o),o.close();return}if(r?.aborted){const g=new Z("cancelled","Request was cancelled");o.error(g),e(g),await a.cancel();return}i+=n.decode(l,{stream:!0});const V=i.split(`
`);i=V.pop()||"";for(const g of V)g.trim()&&s(g.trim(),o);return f()}catch(l){const u=l instanceof Z?l:Oe(0,null);o.error(u),e(u)}}},cancel(){return a.cancel()}})}const gt="@firebase/functions",ht="0.12.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ia="auth-internal",la="app-check-internal",ca="messaging-internal";function da(a){const t=(e,{instanceIdentifier:r})=>{const s=e.getProvider("app").getImmediate(),n=e.getProvider(ia),o=e.getProvider(ca),i=e.getProvider(la);return new Qr(s,n,o,i,r)};gr(new hr(at,t,"PUBLIC").setMultipleInstances(!0)),ct(gt,ht,a),ct(gt,ht,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ua(a=yr(),t=et){const r=br(tt(a),at).getImmediate({identifier:t}),s=wr("functions");return s&&va(r,...s),r}function va(a,t,e){Zr(tt(a),t,e)}function fa(a,t,e){return ea(tt(a),t)}da();class ge{static CODE_LENGTH=4;static CODE_EXPIRY_MS=5*60*1e3;static COLLECTION_NAME="tv_auth_codes";static DEVICE_ID_KEY="tv_device_id";static authCode=z(null);static authStatus=z("idle");static generateCode(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";let e="";for(let r=0;r<this.CODE_LENGTH;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}static getDeviceId(){if(typeof window>"u")return"server";let t=localStorage.getItem(this.DEVICE_ID_KEY);return t||(t="dev_"+Math.random().toString(36).substring(2,15),localStorage.setItem(this.DEVICE_ID_KEY,t)),t}static async storeAuthCode(t){try{return(await Er(Ge(Ce,this.COLLECTION_NAME),{code:t.code,deviceId:t.deviceId,userAgent:t.userAgent,createdAt:Cr(),expiresAt:new Date(Date.now()+this.CODE_EXPIRY_MS),status:"pending"})).id}catch(e){return console.error("Failed to store auth code:",e),null}}static async getAuthCode(t){try{const e=dt(Ge(Ce,this.COLLECTION_NAME),je("code","==",t)),r=await ut(e);if(r.empty)return null;const s=r.docs[0],n=s.data(),o=new Date,i=n.expiresAt.toDate();return o>i?(await Le(s.ref,{status:"expired"}),null):{id:s.id,code:n.code,deviceId:n.deviceId,userAgent:n.userAgent,createdAt:n.createdAt,expiresAt:n.expiresAt,status:n.status,approvedBy:n.approvedBy,approvedByUser:n.approvedByUser}}catch(e){return console.error("Failed to get auth code:",e),null}}static async getPendingAuthCode(t){try{const e=dt(Ge(Ce,this.COLLECTION_NAME),je("code","==",t),je("status","==","pending")),r=await ut(e);if(r.empty)return null;const s=r.docs[0],n=s.data(),o=new Date,i=n.expiresAt.toDate();return o>i?(await Le(s.ref,{status:"expired"}),null):{id:s.id,code:n.code,deviceId:n.deviceId,userAgent:n.userAgent,createdAt:n.createdAt,expiresAt:n.expiresAt,status:n.status,approvedBy:n.approvedBy,approvedByUser:n.approvedByUser}}catch(e){return console.error("Failed to get pending auth code:",e),null}}static async updateAuthCode(t,e,r){try{const s={status:e};return r&&(s.approvedBy=r),await Le(vt(Ce,this.COLLECTION_NAME,t),s),!0}catch(s){return console.error("Failed to update auth code:",s),!1}}static async updateAuthCodeWithUser(t,e,r,s){try{const n={status:e,approvedBy:r,approvedByUser:s};return await Le(vt(Ce,this.COLLECTION_NAME,t),n),!0}catch(n){return console.error("Failed to update auth code:",n),!1}}static async requestTVAuth(){const t=this.generateCode(),e=this.getDeviceId(),r={code:t,deviceId:e,userAgent:navigator.userAgent,createdAt:ft.now(),expiresAt:ft.fromDate(new Date(Date.now()+this.CODE_EXPIRY_MS)),status:"pending"},s=await this.storeAuthCode(r);return s?(r.id=s,this.authCode.set(t),this.authStatus.set("waiting"),new Promise(n=>{console.log("üîÑ Starting TV auth polling for code:",t);const o=setInterval(async()=>{try{console.log("üîç Polling for code approval...",t);const i=await this.getAuthCode(t);if(!i){console.log("‚ùå Code not found or expired"),clearInterval(o),this.authStatus.set("expired"),this.authCode.set(null),n({success:!1,error:"Code expired or not found"});return}if(console.log("üìä Code status:",i.status,"Code data:",i),i.status==="approved"){console.log("‚úÖ Code approved! Starting authentication..."),clearInterval(o),this.authStatus.set("approved"),this.authCode.set(null),this.authenticateWithCustomToken(n,i.approvedByUser,t);return}if(i.status==="denied"){console.log("‚ùå Code denied"),clearInterval(o),this.authStatus.set("denied"),this.authCode.set(null),n({success:!1,error:"Authentication denied"});return}if(i.status==="expired"){console.log("‚è∞ Code expired"),clearInterval(o),this.authStatus.set("expired"),this.authCode.set(null),n({success:!1,error:"Code expired"});return}}catch(i){console.error("‚ùå Error polling for approval:",i)}},2e3);setTimeout(()=>{clearInterval(o),this.authStatus.getValue?.()==="waiting"&&(this.authStatus.set("expired"),this.authCode.set(null),n({success:!1,error:"Code expired"}))},this.CODE_EXPIRY_MS)})):{success:!1,error:"Failed to generate code"}}static async authenticateWithCustomToken(t,e,r){try{if(console.log("üé´ Starting custom token authentication with code:",r),!r){console.log("‚ùå No code available for authentication"),t({success:!1,error:"No code available for authentication"});return}console.log("‚òÅÔ∏è Calling generateTVToken Cloud Function...");const s=ua(),o=await fa(s,"generateTVToken")({code:r});console.log("üì• Cloud Function response:",o.data);const{customToken:i,userInfo:f}=o.data;if(!i){console.log("‚ùå No custom token received from Cloud Function"),t({success:!1,error:"Failed to generate authentication token"});return}console.log("üîê Signing in with custom token...");const l=await kr(Q,i);console.log("‚úÖ Successfully signed in with custom token!",l.user),t({success:!0,user:l.user})}catch(s){console.error("‚ùå Custom token authentication failed:",s);let n="Authentication failed";s?.code==="functions/not-found"?n="Code not found or not approved":s?.code==="functions/deadline-exceeded"?n="Code has expired":s?.message&&(n=s.message),console.log("üí• Authentication error details:",{code:s?.code,message:s?.message,details:s?.details}),t({success:!1,error:n})}}static async approveCode(t){try{console.log("üì± Starting code approval for:",t.toUpperCase());const e=Q.currentUser;if(!e)return console.log("‚ùå No user logged in for approval"),{success:!1,error:"User not logged in"};console.log("üë§ Approving user:",{uid:e.uid,email:e.email}),console.log("üîç Looking up pending code in Firestore...");const r=await this.getPendingAuthCode(t.toUpperCase());if(!r)return console.log("‚ùå Pending code not found or expired"),{success:!1,error:"Invalid or expired code"};console.log("üìã Found code:",r);const s={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL};return console.log("üíæ Updating code status to approved..."),await this.updateAuthCodeWithUser(r.id,"approved",e.uid,s)?(console.log("‚úÖ Code approved successfully!"),{success:!0}):(console.log("‚ùå Failed to update code status"),{success:!1,error:"Failed to approve code"})}catch(e){return console.error("‚ùå Error approving code:",e),{success:!1,error:"Failed to approve code"}}}static async denyCode(t){try{const e=Q.currentUser;if(!e)return{success:!1,error:"User not logged in"};const r=await this.getAuthCode(t.toUpperCase());return r?await this.updateAuthCode(r.id,"denied",e.uid)?{success:!0}:{success:!1,error:"Failed to deny code"}:{success:!1,error:"Invalid or expired code"}}catch(e){return console.error("Error denying code:",e),{success:!1,error:"Failed to deny code"}}}static cancelTVAuth(){this.authCode.set(null),this.authStatus.set("idle")}static async cleanupExpiredCodes(){}static initialize(){}static getTimeRemaining(t){const e=Date.now(),r=t.toMillis()+this.CODE_EXPIRY_MS,s=Math.max(0,r-e),n=Math.floor(s/6e4),o=Math.floor(s%6e4/1e3);return`${n}:${o.toString().padStart(2,"0")}`}static async isLikelyTV(){const{isAndroidTV:t}=await $r(async()=>{const{isAndroidTV:e}=await import("../chunks/C13OeFrB.js").then(r=>r.b);return{isAndroidTV:e}},__vite__mapDeps([0,1,2]),import.meta.url);return await t()}static getDeviceDisplayName(t){const e=t.toLowerCase();return e.includes("android tv")||e.includes("googletv")?"üì∫ Android TV":e.includes("smart-tv")||e.includes("smarttv")?"üì∫ Smart TV":e.includes("mobile")?"üì± Mobile Device":e.includes("tablet")?"üì± Tablet":e.includes("electron")?"üíª Desktop App":"üñ•Ô∏è Unknown Device"}}typeof window<"u"&&ge.initialize();var pa=D("<div><span> </span></div>"),ga=D('<span class="mr-2">‚úì</span> Approve TV Login',1),ha=D('<div class="w-full max-w-md mx-auto p-4"><div class="mb-6"><h2 class="text-xl font-bold text-gray-800 flex items-center"><span class="mr-2">üì∫</span> TV Login Code</h2> <p class="text-sm text-gray-600 mt-1">Enter the 4-letter code from your TV to approve login</p></div> <!> <div class="space-y-4"><div><label class="label" for="tv-code-input"><span class="label-text">4-Letter Code:</span></label> <input id="tv-code-input" type="text" class="input input-bordered w-full text-center text-2xl font-mono uppercase tracking-widest" placeholder="ABCD" maxlength="4"/></div> <div class="space-y-2"><button><!></button> <button class="btn btn-error btn-sm w-full"><span class="mr-1">‚úó</span> Deny</button></div></div> <div class="mt-6 p-3 bg-blue-50 rounded-lg"><h4 class="font-semibold text-blue-800 text-sm mb-1">How it works:</h4> <ol class="text-xs text-blue-700 space-y-1 list-decimal list-inside"><li>Your TV displays a 4-letter code</li> <li>Enter the exact code here</li> <li>Click "Approve" to sign in your TV</li></ol> <p class="text-xs text-blue-600 mt-2">‚ö†Ô∏è Only approve codes you recognize from your own TV</p></div></div>');function ma(a,t){Pe(t,!1);let e=se(""),r=se(!1),s=se(""),n=se("info");async function o(){if(w(e).length!==4){f("Please enter a 4-letter code","error");return}$(r,!0);try{const v=await ge.approveCode(w(e));v.success?(f("TV login approved successfully!","success"),$(e,"")):f(v.error||"Failed to approve code","error")}catch{f("Failed to approve code","error")}finally{$(r,!1)}}async function i(){if(w(e).length!==4){f("Please enter a 4-letter code","error");return}$(r,!0);try{const v=await ge.denyCode(w(e));v.success?(f("TV login denied","info"),$(e,"")):f(v.error||"Failed to deny code","error")}catch{f("Failed to deny code","error")}finally{$(r,!1)}}function f(v,m){$(s,v),$(n,m),setTimeout(()=>{$(s,"")},5e3)}function l(v){v.key==="Enter"&&o()}Se();var u=ha(),V=h(d(u),2);{var g=v=>{var m=pa();let N;var T=d(m),x=d(T,!0);c(T),c(m),B(k=>{N=he(m,1,"alert mb-4",null,N,k),X(x,w(s))},[()=>({"alert-success":w(n)==="success","alert-error":w(n)==="error","alert-info":w(n)==="info"})]),E(v,m)};q(V,v=>{w(s)&&v(g)})}var _=h(V,2),y=d(_),p=h(d(y),2);we(p),c(y);var A=h(y,2),L=d(A);let F;var C=d(L);{var M=v=>{var m=_t("Approving...");E(v,m)},P=v=>{var m=ga();ve(),E(v,m)};q(C,v=>{w(r)?v(M):v(P,!1)})}c(L);var b=h(L,2);c(A),c(_),ve(2),c(u),B(v=>{p.disabled=w(r),F=he(L,1,"btn btn-success w-full",null,F,v),L.disabled=w(e).length!==4||w(r),b.disabled=w(e).length!==4||w(r)},[()=>({loading:w(r)})]),_e(p,()=>w(e),v=>$(e,v)),W("input",p,v=>{const m=v.target;$(e,m.value.toUpperCase().replace(/[^A-Z]/g,""))}),W("keydown",p,l),W("click",L,o),W("click",b,i),E(a,u),Ne()}var ya=D('<span class="loading loading-spinner loading-sm"></span> Uploading...',1),ba=xt('<svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg> Upload Photo',1),wa=D('<input type="file" accept="image/*" class="hidden"/> <div class="flex flex-col items-center space-y-4"><button class="btn w-full border-orange-500 bg-orange-500 text-white hover:bg-orange-600"><!></button> <button class="btn w-full border-red-500 bg-red-500 text-white hover:bg-red-600"><svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Slideshow</button> <div class="w-full"><div class="collapse-arrow bg-base-200 collapse"><input type="checkbox"/> <div class="collapse-title text-lg font-medium">üì∫ Approve TV Login</div> <div class="collapse-content"><!></div></div></div></div>',1);function _a(a,t){Pe(t,!1);const[e,r]=rt(),s=()=>ae(i,"$uploading",e);let n=Qe(t,"user",8),o=Qe(t,"uploadedImages",12);const i=z(!1),f=z(o());f.subscribe(m=>{o(m)});let l=se();function u(){w(l)?.click()}async function V(m){const N=m.target,T=N.files;if(!(!T||T.length===0||!n())){i.set(!0);try{const x=T[0];if(!x.type.startsWith("image/")){alert("Please select an image file");return}const k=Date.now(),I=`${n().uid}/${k}_${x.name}`,Y=Et(Ct,`images/${I}`),R=await Ir(Y,x),ee=await kt(R.ref);f.set([...o(),ee]);const te=await St.loadUserImagesWithRetry(n(),o().length-1);f.set(te)}catch(x){console.error("Upload failed:",x),alert("Upload failed. Please try again.")}finally{i.set(!1),N.value=""}}}dr(()=>vr(o()),()=>{f.set(o())}),ur(),Se();var g=wa(),_=Ie(g);Fr(_,m=>$(l,m),()=>w(l));var y=h(_,2),p=d(y),A=d(p);{var L=m=>{var N=ya();ve(),E(m,N)},F=m=>{var N=ba();ve(),E(m,N)};q(A,m=>{s()?m(L):m(F,!1)})}c(p);var C=h(p,2),M=h(C,2),P=d(M),b=h(d(P),4),v=d(b);ma(v,{}),c(b),c(P),c(M),c(y),B(()=>p.disabled=s()),W("change",_,V),W("click",p,u),W("click",C,()=>Rr("/slideshow")),E(a,g),Ne(),r()}class ye{static async register(t,e,r){try{const n=(await Sr(Q,t,e)).user;return r&&await Pr(n,{displayName:r}),console.log("User registered successfully:",n.uid),n}catch(s){console.error("Registration error:",s);const n=s;throw new Error(this.getErrorMessage(n.code))}}static async signIn(t,e){try{const r=await Nr(Q,t,e);return console.log("User signed in successfully:",r.user.uid),r.user}catch(r){console.error("Sign in error:",r);const s=r;throw new Error(this.getErrorMessage(s.code))}}static async resetPassword(t){try{await Dr(Q,t),console.log("Password reset email sent to:",t)}catch(e){console.error("Password reset error:",e);const r=e;throw new Error(this.getErrorMessage(r.code))}}static async signOut(){try{await Q.signOut(),console.log("User signed out successfully")}catch(t){throw console.error("Sign out error:",t),t}}static getCurrentUser(){return Q.currentUser}static async getCurrentUserAsync(){return new Promise(t=>{const e=Q.onAuthStateChanged(r=>{e(),t(r)})})}static isSignedIn(){return!!Q.currentUser}static async getAuthToken(){try{const t=Q.currentUser;return t?await t.getIdToken():null}catch(t){return console.error("Error getting auth token:",t),null}}static async refreshAuthToken(){try{const t=Q.currentUser;return t?await t.getIdToken(!0):null}catch(t){return console.error("Error refreshing auth token:",t),null}}static getErrorMessage(t){switch(t){case"auth/email-already-in-use":return"This email address is already registered. Please use a different email or try signing in.";case"auth/invalid-email":return"Please enter a valid email address.";case"auth/operation-not-allowed":return"Email/password accounts are not enabled. Please contact support.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/user-disabled":return"This account has been disabled. Please contact support.";case"auth/user-not-found":return"No account found with this email address. Please check your email or create a new account.";case"auth/wrong-password":return"Incorrect password. Please try again or reset your password.";case"auth/invalid-credential":return"Invalid email or password. Please check your credentials and try again.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later or reset your password.";case"auth/network-request-failed":return"Network error. Please check your internet connection and try again.";default:return"An error occurred during authentication. Please try again."}}static isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static isValidPassword(t){return t.length<6?{valid:!1,message:"Password must be at least 6 characters long"}:{valid:!0}}}var xa=D('<span class="loading loading-spinner loading-sm mr-2"></span> Sending...',1),Aa=xt('<svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> Send Reset Email',1),Ta=D(`<div class="space-y-4"><div class="text-center"><h2 class="text-2xl font-bold text-gray-800">Reset Password</h2> <p class="mt-2 text-sm text-gray-600">Enter your email address and we'll send you a link to reset your password</p></div> <div class="space-y-4"><div><label for="reset-email" class="mb-1 block text-sm font-medium text-gray-700">Email Address</label> <input id="reset-email" type="email" placeholder="Enter your email" class="input input-bordered w-full"/></div> <button class="btn w-full border-0 bg-blue-500 text-white hover:bg-blue-600"><!></button> <button class="btn btn-ghost w-full text-gray-600">Back to Sign In</button></div></div>`),Ea=D(`<div class="text-center"><p class="text-sm text-gray-600">Don't have an account? <button class="ml-1 font-semibold text-orange-600 underline hover:text-orange-700">Create Account</button></p></div>`),Ca=D('<div><label for="display-name" class="mb-1 block text-sm font-medium text-gray-700">Display Name</label> <input id="display-name" type="text" placeholder="Name to display" class="input input-bordered w-full" required/></div>'),ka=D('<p class="mt-1 text-xs text-gray-500">Password must be at least 6 characters long</p>'),Ia=D('<div><label for="confirm-password" class="mb-1 block text-sm font-medium text-gray-700">Confirm Password</label> <input id="confirm-password" type="password" placeholder="Confirm your password" class="input input-bordered w-full" required/></div>'),Sa=D('<span class="loading loading-spinner loading-sm mr-2"></span> ',1),Pa=D('<button class="text-sm text-blue-600 underline hover:text-blue-700">Forgot your password?</button>'),Na=D('<div class="flex items-center"><div class="flex-1 border-t border-gray-300"></div> <span class="px-3 text-sm text-gray-500">or</span> <div class="flex-1 border-t border-gray-300"></div></div> <p class="text-sm text-gray-600">Already have an account? <button class="ml-1 text-blue-600 underline hover:text-blue-700">Sign In</button></p>',1),Da=D('<div class="space-y-4"><div class="text-center"><h2 class="text-2xl font-bold text-gray-800"> </h2> <p class="mt-2 text-sm text-gray-600"> </p></div> <!> <form class="space-y-4"><!> <div><label for="email" class="mb-1 block text-sm font-medium text-gray-700">Email Address</label> <input id="email" type="email" placeholder="Enter your email" class="input input-bordered w-full" required/></div> <div><label for="password" class="mb-1 block text-sm font-medium text-gray-700">Password</label> <input id="password" type="password" placeholder="Enter your password" class="input input-bordered w-full" required/> <!></div> <!> <button type="submit" class="btn w-full border-0 bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600"><!></button></form> <div class="space-y-2 text-center"><!> <!></div></div>'),Ua=D("<div> </div>"),La=D('<div class="space-y-6"><!> <!></div>');function Va(a,t){Pe(t,!1);const[e,r]=rt(),s=()=>ae(L,"$email",e),n=()=>ae(F,"$password",e),o=()=>ae(y,"$isRegistering",e),i=()=>ae(M,"$displayName",e),f=()=>ae(C,"$confirmPassword",e),l=()=>ae(p,"$isLoading",e),u=()=>ae(P,"$resetEmail",e),V=()=>ae(A,"$showForgotPassword",e),g=()=>ae(b,"$message",e),_=()=>ae(v,"$messageType",e),y=z(!0),p=z(!1),A=z(!1),L=z(""),F=z(""),C=z(""),M=z(""),P=z(""),b=z(""),v=z("error");function m(){y.update(U=>!U),x()}function N(){A.set(!0),x()}function T(){A.set(!1),x()}function x(){L.set(""),F.set(""),C.set(""),M.set(""),P.set(""),b.set("")}function k(){b.set("")}function I(U,H="error"){b.set(U),v.set(H)}function Y(){if(!s()||!n())return I("Please fill in all required fields"),!1;if(!ye.isValidEmail(s()))return I("Please enter a valid email address"),!1;const U=ye.isValidPassword(n());if(!U.valid)return I(U.message||"Invalid password"),!1;if(o()){if(!i()?.trim())return I("Please enter your name"),!1;if(n()!==f())return I("Passwords do not match"),!1}return!0}async function R(){if(!l()&&(k(),!!Y())){p.set(!0);try{o()?(await ye.register(s(),n(),i()),I("Account created successfully! You are now signed in.","success")):(await ye.signIn(s(),n()),I("Signed in successfully!","success"))}catch(U){I(U.message||"An error occurred. Please try again.")}finally{p.set(!1)}}}async function ee(){if(!l()){if(k(),!u()){I("Please enter your email address");return}if(!ye.isValidEmail(u())){I("Please enter a valid email address");return}p.set(!0);try{await ye.resetPassword(u()),I("Password reset email sent! Check your inbox.","success"),P.set("")}catch(U){I(U.message||"Failed to send password reset email")}finally{p.set(!1)}}}Se();var te=La(),le=d(te);{var re=U=>{var H=Ta(),J=h(d(H),2),ne=d(J),me=h(d(ne),2);we(me),c(ne);var de=h(ne,2),Fe=d(de);{var De=oe=>{var Ae=xa();ve(),E(oe,Ae)},Re=oe=>{var Ae=Aa();ve(),E(oe,Ae)};q(Fe,oe=>{l()?oe(De):oe(Re,!1)})}c(de);var pe=h(de,2);c(J),c(H),B(()=>{me.disabled=l(),de.disabled=l(),pe.disabled=l()}),_e(me,u,oe=>ke(P,oe)),W("input",me,k),W("click",de,ee),W("click",pe,T),E(U,H)},G=U=>{var H=Da(),J=d(H),ne=d(J),me=d(ne,!0);c(ne);var de=h(ne,2),Fe=d(de,!0);c(de),c(J);var De=h(J,2);{var Re=S=>{var O=Ea(),j=d(O),ce=h(d(j));c(j),c(O),B(()=>ce.disabled=l()),W("click",ce,m),E(S,O)};q(De,S=>{o()||S(Re)})}var pe=h(De,2),oe=d(pe);{var Ae=S=>{var O=Ca(),j=h(d(O),2);we(j),c(O),B(()=>j.disabled=l()),_e(j,i,ce=>ke(M,ce)),W("input",j,k),E(S,O)};q(oe,S=>{o()&&S(Ae)})}var $e=h(oe,2),Ue=h(d($e),2);we(Ue),c($e);var Be=h($e,2),Te=h(d(Be),2);we(Te);var Dt=h(Te,2);{var Ut=S=>{var O=ka();E(S,O)};q(Dt,S=>{o()&&S(Ut)})}c(Be);var st=h(Be,2);{var Lt=S=>{var O=Ia(),j=h(d(O),2);we(j),c(O),B(()=>j.disabled=l()),_e(j,f,ce=>ke(C,ce)),W("input",j,k),E(S,O)};q(st,S=>{o()&&S(Lt)})}var qe=h(st,2),Vt=d(qe);{var Mt=S=>{var O=Sa(),j=h(Ie(O));B(()=>X(j,` ${o()?"Creating Account...":"Signing In..."}`)),E(S,O)},Ot=S=>{var O=_t();B(()=>X(O,o()?"Create Account":"Sign In")),E(S,O)};q(Vt,S=>{l()?S(Mt):S(Ot,!1)})}c(qe),c(pe);var nt=h(pe,2),ot=d(nt);{var Ft=S=>{var O=Pa();B(()=>O.disabled=l()),W("click",O,N),E(S,O)};q(ot,S=>{o()||S(Ft)})}var Rt=h(ot,2);{var $t=S=>{var O=Na(),j=h(Ie(O),2),ce=h(d(j));c(j),B(()=>ce.disabled=l()),W("click",ce,m),E(S,O)};q(Rt,S=>{o()&&S($t)})}c(nt),c(H),B(()=>{X(me,o()?"Create Account":"Sign In"),X(Fe,o()?"Create your FotoTV account to get started":"Welcome back! Please sign in to continue"),Ue.disabled=l(),Te.disabled=l(),qe.disabled=l()}),_e(Ue,s,S=>ke(L,S)),W("input",Ue,k),_e(Te,n,S=>ke(F,S)),W("input",Te,k),W("submit",pe,Yr(R)),E(U,H)};q(le,U=>{V()?U(re):U(G,!1)})}var K=h(le,2);{var fe=U=>{var H=Ua(),J=d(H,!0);c(H),B(()=>{he(H,1,`rounded-lg p-3 text-center text-sm ${_()==="error"?"border border-red-200 bg-red-50 text-red-600":"border border-green-200 bg-green-50 text-green-600"}`),X(J,g())}),E(U,H)};q(K,U=>{g()&&U(fe)})}c(te),E(a,te),Ne(),r()}var Ma=D('<div class="alert alert-error"><span> </span></div>'),Oa=D(`<div class="space-y-6"><div class="bg-opacity-10 rounded-lg bg-white p-4"><p class="text-sm text-blue-200">To sign in on your TV, you'll need to approve the login from a device where you're
						already signed in.</p></div> <button> </button> <!></div>`),Fa=D('<div class="flex h-16 w-16 items-center justify-center rounded-lg bg-white text-3xl font-bold text-black"> </div>'),Ra=D('<p class="text-sm text-blue-300">Code expires in: <span class="font-mono font-bold"> </span></p>'),$a=D('<div class="space-y-6"><div class="text-center"><p class="mb-4 text-blue-200">Enter this code on your signed-in device:</p> <div class="mx-auto mb-4 inline-flex space-x-2"></div> <!></div> <div class="bg-opacity-10 rounded-lg bg-white p-4"><div class="flex items-center justify-center space-x-2"><span class="animate-pulse text-2xl">‚è≥</span> <span class="text-blue-200">Waiting for approval from your phone...</span></div></div> <div class="space-y-2 text-left text-sm text-blue-200"><p class="font-semibold">How to approve:</p> <ol class="ml-4 list-inside list-decimal space-y-1"><li>Open PhotoTV on your phone</li> <li>Go to "Approve TV Login" section</li> <li>Enter the code: <span class="font-mono font-bold text-white"> </span></li> <li>Tap "Approve TV Login" to sign in</li></ol></div> <button class="btn btn-ghost btn-sm w-full">Cancel</button></div>'),Ba=D('<button class="btn btn-primary btn-lg w-full">Try Again</button>'),qa=D('<div class="space-y-6"><div class="text-center"><div class="mb-4 text-6xl"> </div> <p class="text-lg"> </p></div> <!></div>'),Ha=D(`<div class="flex min-h-screen flex-col items-center justify-center bg-gradient-to-br from-blue-900 to-purple-900 p-8"><div class="bg-opacity-10 w-full max-w-md rounded-2xl bg-white p-8 text-center text-white shadow-xl backdrop-blur-lg"><div class="mb-8"><div class="bg-opacity-20 mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-white"><span class="text-2xl">üì∫</span></div> <h1 class="text-2xl font-bold">TV Sign In</h1> <p class="mt-2 text-blue-200">Simple authentication for your TV</p></div> <!> <div class="border-opacity-20 mt-8 border-t border-white pt-6"><p class="text-xs text-blue-300">Make sure you're signed in on your phone or tablet first</p></div></div></div>`);function Wa(a,t){Pe(t,!1);let e=Qe(t,"onLoginSuccess",8,()=>{}),r=se(""),s=se("idle"),n=se(""),o=se(!1),i=se(""),f=null,l=null,u=null;At(()=>{f=ge.authCode.subscribe(b=>{$(r,b||"")}),l=ge.authStatus.subscribe(b=>{$(s,b),b==="waiting"&&w(r)?V():g()})}),fr(()=>{f&&f(),l&&l(),g()});function V(){u&&clearInterval(u),u=setInterval(()=>{if(w(r)){const b=Date.now()-1e3,v=Math.max(0,5*60*1e3-(Date.now()-b)),m=Math.floor(v/6e4),N=Math.floor(v%6e4/1e3);$(n,`${m}:${N.toString().padStart(2,"0")}`)}},1e3)}function g(){u&&(clearInterval(u),u=null)}async function _(){$(o,!0),$(i,"");try{const b=await ge.requestTVAuth();b.success&&b.user?e()(b.user):b.error&&$(i,b.error)}catch(b){$(i,"Failed to start TV authentication"),console.error("TV Auth error:",b)}finally{$(o,!1)}}function y(){ge.cancelTVAuth(),g(),$(i,"")}function p(){switch(w(s)){case"waiting":return"Waiting for approval from your phone...";case"approved":return"Login approved! Welcome to PhotoTV!";case"denied":return"Authentication was denied. Please try again.";case"expired":return"Code expired. Please generate a new code.";default:return""}}function A(){switch(w(s)){case"waiting":return"‚è≥";case"approved":return"‚úÖ";case"denied":return"‚ùå";case"expired":return"‚è∞";default:return""}}Se();var L=Ha(),F=d(L),C=h(d(F),2);{var M=b=>{var v=Oa(),m=h(d(v),2);let N;var T=d(m,!0);c(m);var x=h(m,2);{var k=I=>{var Y=Ma(),R=d(Y),ee=d(R);c(R),c(Y),B(()=>X(ee,`‚ùå ${w(i)??""}`)),E(I,Y)};q(x,I=>{w(i)&&I(k)})}c(v),B(I=>{N=he(m,1,"btn btn-primary btn-lg w-full text-lg",null,N,I),m.disabled=w(o),X(T,w(o)?"Starting...":"Start TV Sign In")},[()=>({loading:w(o)})]),W("click",m,_),E(b,v)},P=b=>{var v=Tt(),m=Ie(v);{var N=x=>{var k=$a(),I=d(k),Y=h(d(I),2);Hr(Y,5,()=>(w(r),Ve(()=>w(r).split(""))),Br,(U,H)=>{var J=Fa(),ne=d(J,!0);c(J),B(()=>X(ne,w(H))),E(U,J)}),c(Y);var R=h(Y,2);{var ee=U=>{var H=Ra(),J=h(d(H)),ne=d(J,!0);c(J),c(H),B(()=>X(ne,w(n))),E(U,H)};q(R,U=>{w(n)&&U(ee)})}c(I);var te=h(I,4),le=h(d(te),2),re=h(d(le),4),G=h(d(re)),K=d(G,!0);c(G),c(re),ve(2),c(le),c(te);var fe=h(te,2);c(k),B(()=>X(K,w(r))),W("click",fe,y),E(x,k)},T=x=>{var k=qa(),I=d(k),Y=d(I),R=d(Y,!0);c(Y);var ee=h(Y,2),te=d(ee,!0);c(ee),c(I);var le=h(I,2);{var re=G=>{var K=Ba();W("click",K,_),E(G,K)};q(le,G=>{(w(s)==="denied"||w(s)==="expired")&&G(re)})}c(k),B((G,K)=>{X(R,G),X(te,K)},[()=>Ve(A),()=>Ve(p)]),E(x,k)};q(m,x=>{w(s)==="waiting"&&w(r)?x(N):x(T,!1)},!0)}E(b,v)};q(C,b=>{w(s)==="idle"?b(M):b(P,!1)})}ve(2),c(F),c(L),E(a,L),Ne()}var Ya=D('<div class="avatar"><div class="h-8 w-8 rounded-full ring ring-orange-500 ring-offset-1 ring-offset-white"><img alt="User avatar"/></div></div>'),Ga=D('<div class="flex h-8 w-8 items-center justify-center rounded-full bg-orange-500 ring ring-orange-500 ring-offset-1 ring-offset-white"><span class="text-sm font-semibold text-white"> </span></div>'),ja=D('<div class="absolute top-4 right-4 z-10 flex items-center space-x-2"><!> <div class="text-sm text-gray-800"><span class="font-semibold"> </span></div> <button class="btn btn-sm ml-2 border-white bg-white text-gray-700 hover:bg-gray-100">Logout</button></div>'),za=D('<span class="badge badge-secondary text-xs">TV Mode</span>'),Ja=D('<div class="relative flex min-h-screen flex-col items-center justify-center bg-gradient-to-br from-orange-100 to-red-100 p-4"><!> <div><div class="flex items-center space-x-3"><img src="/FotoTV-logo2.png" alt="FotoTV Logo"/> <div class="flex items-center space-x-2"><h1>FotoTV</h1> <!></div></div></div> <div class="w-full max-w-md"><!></div></div>');function os(a,t){Pe(t,!1);const[e,r]=rt(),s=()=>ae(o,"$user",e),n=()=>ae(i,"$uploadedImages",e),o=z(null),i=z([]);let f=se(!1),l=se(!1);At(()=>($(l,Mr()),Or().then(x=>{$(f,x)}).catch(x=>{console.warn("Failed to detect TV device:",x)}),Ur(Q,async x=>{if(o.set(x),x){const k=await St.loadUserImages(x);i.set(k)}else i.set([])})));function u(){Lr(Q).catch(console.error)}function V(T){o.set(T)}Se();var g=Ja(),_=d(g);{var y=T=>{var x=ja(),k=d(x);{var I=re=>{var G=Ya(),K=d(G),fe=d(K);c(K),c(G),B(()=>Vr(fe,"src",s().photoURL)),E(re,G)},Y=re=>{var G=Ga(),K=d(G),fe=d(K,!0);c(K),c(G),B(U=>X(fe,U),[()=>s().displayName?s().displayName.charAt(0).toUpperCase():s().email?.charAt(0).toUpperCase()||"U"]),E(re,G)};q(k,re=>{s().photoURL?re(I):re(Y,!1)})}var R=h(k,2),ee=d(R),te=d(ee,!0);c(ee),c(R);var le=h(R,2);c(x),B(()=>X(te,s().displayName||s().email)),W("click",le,u),E(T,x)};q(_,T=>{s()&&T(y)})}var p=h(_,2),A=d(p),L=d(A),F=h(L,2),C=d(F),M=h(C,2);{var P=T=>{var x=za();E(T,x)};q(M,T=>{w(l)&&T(P)})}c(F),c(A),c(p);var b=h(p,2),v=d(b);{var m=T=>{_a(T,{get user(){return s()},get uploadedImages(){return n()}})},N=T=>{var x=Tt(),k=Ie(x);{var I=R=>{Wa(R,{onLoginSuccess:V})},Y=R=>{Va(R,{})};q(k,R=>{w(f)||w(l)?R(I):R(Y,!1)},!0)}E(T,x)};q(v,T=>{s()?T(m):T(N,!1)})}c(b),c(g),B(()=>{he(p,1,`${s()?"absolute top-4 left-4":"absolute top-8 left-1/2 -translate-x-1/2 transform"} z-10`),he(L,1,`${s()?"h-8":"h-16"} w-auto`),he(C,1,`${s()?"text-lg":"text-3xl"} font-bold text-gray-800`)}),E(a,g),Ne(),r()}export{os as component};
